<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 11 Simulator</title>
    <style>
        /* Import Roboto font from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap');

        /* Global Styles */
        :root {
            --bg-color-light: #f3f3f3;
            --text-color-light: #000;
            --bg-color-dark: #1e1e1e;
            --text-color-dark: #fff;
            --taskbar-bg-light: rgba(243, 243, 243, 0.8);
            --taskbar-bg-dark: rgba(30, 30, 30, 0.8);
            --start-menu-bg-light: rgba(243, 243, 243, 0.95);
            --start-menu-bg-dark: rgba(30, 30, 30, 0.95);
            --window-bg-light: #fff;
            --window-bg-dark: #2d2d2d;
            --window-border-light: #ccc;
            --window-border-dark: #555;
            --button-bg-light: #e0e0e0;
            --button-bg-dark: #3c3c3c; /* Slightly lighter for better contrast */
            --button-hover-light: #d5d5d5;
            --button-hover-dark: #505050;
            --input-bg-light: var(--bg-color-light);
            --input-bg-dark: var(--bg-color-dark);
            --input-border-light: #ccc;
            --input-border-dark: #555;
            --scrollbar-thumb-light: #c1c1c1;
            --scrollbar-thumb-dark: #888;
            --scrollbar-track-light: #f1f1f1;
            --scrollbar-track-dark: #2d2d2d;
            --accent-color: #0078d4; /* Windows accent color */
            --power-options-bg-light: rgba(243, 243, 243, 0.98);
            --power-options-bg-dark: rgba(30, 30, 30, 0.98);
            --calc-button-bg-light: #f0f0f0;
            --calc-button-bg-dark: #333;
            --calc-button-hover-light: #e0e0e0;
            --calc-button-hover-dark: #444;
            --calc-operator-bg-light: #ddd;
            --calc-operator-bg-dark: #555;
            --calc-operator-hover-light: #ccc;
            --calc-operator-hover-dark: #666;
            --calc-equals-bg: var(--accent-color);
            --calc-equals-hover: #005a9e;
           --placeholder-color-light: #888; 
           --placeholder-color-dark: #bbb;  
        }

        html {
            height: 100%;
        }

        body {
            margin: 0;
            /* Changed font-family to Roboto */
            font-family: 'Roboto', 'Segoe UI Variable', 'Segoe UI', sans-serif;
            color: var(--text-color-light);
            background-color: var(--bg-color-light);
            transition: background-color 0.3s, color 0.3s;
            cursor: none;
            overflow: auto;
            min-height: 100%;
        }

        input, select, textarea, button {
            font-family: 'Roboto', 'Segoe UI Variable', 'Segoe UI', sans-serif; /* Match body font stack */
        }

        input::placeholder, 
        textarea::placeholder {
            color: var(--placeholder-color-light);
            opacity: 1; /* Ensure consistent opacity */
        }

        body.dark-mode input::placeholder,
        body.dark-mode textarea::placeholder {
            color: var(--placeholder-color-dark);
        }

        /* Dark Mode */
        body.dark-mode {
            color: var(--text-color-dark);
            background-color: var(--bg-color-dark);
        }

        body.dark-mode .taskbar {
            background-color: var(--taskbar-bg-dark);
        }

        body.dark-mode .start-menu {
            background-color: var(--start-menu-bg-dark);
        }
        body.dark-mode #power-options-popup {
            background-color: var(--power-options-bg-dark);
            border-color: var(--window-border-dark);
        }
        body.dark-mode #power-options-popup button {
            background-color: var(--button-bg-dark);
            color: var(--text-color-dark);
            border-color: var(--button-hover-dark);
        }
        body.dark-mode #power-options-popup button:hover {
            background-color: var(--button-hover-dark);
        }


        body.dark-mode .window {
            background-color: var(--window-bg-dark);
            border-color: var(--window-border-dark);
        }

        body.dark-mode .settings-section button,
        body.dark-mode #setup-content button,
        body.dark-mode #password-content button
        {
            /* Accent buttons, style remains consistent */
        }
        body.dark-mode .window-content button { /* For general buttons inside app windows like click game */
             /* Default button styles might need adjustment if not using accent color */
        }


        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background-color: var(--input-bg-dark);
            border-color: var(--input-border-dark);
            color: var(--text-color-dark);
        }

        body.dark-mode ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb-dark);
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: var(--scrollbar-track-dark);
        }

        /* Ensure general window content text inherits dark mode color */
        body.dark-mode .window-content {
            color: var(--text-color-dark);
        }
        body.dark-mode .window-content p,
        body.dark-mode .window-content h1:not([style*="color: white"]), /* Keep explicit white for Minecraft if that's intended over variable */
        body.dark-mode .window-content h2,
        body.dark-mode .window-content h3,
        body.dark-mode .window-content span:not(.window-title):not(#click-count):not(#battery-level), /* Avoid affecting specific spans like window titles or already styled elements */
        body.dark-mode .window-content div[style*="text-align: center"] p, /* For Amazon product items */
        body.dark-mode .window-content div[style*="text-align: left"] p, /* For YouTube video titles */
        body.dark-mode #microsoft-store-window .window-content div[style*="text-align: center"] p, /* For MS Store app/game text */
        body.dark-mode #google-drive-window .window-content div[style*="border: 1px dashed #ccc"] p {
            color: var(--text-color-dark) !important; /* Use important if inline styles are present */
        }
        body.dark-mode #click-count, body.dark-mode #battery-level {
             color: var(--text-color-dark); /* Ensure these specific spans are also updated */
        }

        /* Specific fixes for apps based on subtask */
        /* Minecraft h1 already handled by direct style change or previous generic h1 rule */

        body.dark-mode #microsoft-store-window .window-content svg {
            fill: var(--text-color-dark);
        }
        /* Fix for MS Store text not covered by the general p rule if needed */
        body.dark-mode #microsoft-store-window .window-content h2,
        body.dark-mode #microsoft-store-window .window-content p {
             color: var(--text-color-dark);
        }

        body.dark-mode #calendar-window .window-content,
        body.dark-mode #calendar-window h2 {
            color: var(--text-color-dark);
        }
         body.dark-mode #calendar-window .window-content div[style*="font-weight: 500"] { /* Day names etc. */
             color: var(--text-color-dark);
         }
         body.dark-mode #calendar-window .window-content div[style*="color: #999"] {
            color: #777 !important; /* Make previous/next month days slightly lighter in dark mode */
        }
         body.dark-mode #calendar-window button { /* This covers prev/next month buttons */
            color: var(--text-color-dark);
        }

        /* Ensure buttons in placeholder apps like Xbox, Teams, GitHub, Google Play have correct dark mode text if not covered by global button rules */
        body.dark-mode #xbox-window .window-content button[style*="background-color: var(--button-bg-light)"],
        body.dark-mode #teams-window .window-content button[style*="background-color: var(--button-bg-light)"],
        body.dark-mode #github-window .window-content button, /* GitHub buttons are generic */
        body.dark-mode #google-play-window .window-content button[style*="background-color: var(--button-bg-light)"] {
            color: var(--text-color-dark); /* Ensure text is dark mode compatible */
            /* Background and border should be handled by the more generic rule:
               body.dark-mode .window-content button:not(#click-button):not(.calculator-button):not(.settings-section button):not(.google-play-button)
               If not, specific background/border rules would be needed here too.
            */
        }

        /* Ensure text in specific problematic apps is dark mode compatible (some might be redundant with general rules but added for safety) */
        body.dark-mode #amazon-window .window-content p,
        body.dark-mode #youtube-window .window-content p,
        body.dark-mode #google-meet-window .window-content h2,
        body.dark-mode #google-meet-window .window-content p,
        body.dark-mode #google-drive-window .window-content h2,
        body.dark-mode #google-drive-window .window-content p,
        body.dark-mode #bing-window .window-content h2, /* Bing, Xbox, Teams, GitHub, Google, Google Play */
        body.dark-mode #bing-window .window-content p,
        body.dark-mode #xbox-window .window-content h2,
        body.dark-mode #xbox-window .window-content p,
        body.dark-mode #teams-window .window-content h2,
        body.dark-mode #teams-window .window-content p,
        body.dark-mode #github-window .window-content h2,
        body.dark-mode #github-window .window-content p,
        body.dark-mode #google-window .window-content h2,
        body.dark-mode #google-window .window-content p,
        body.dark-mode #google-play-window .window-content h2,
        body.dark-mode #google-play-window .window-content p {
            color: var(--text-color-dark);
        }
         /* Fix for text within divs styled with specific light-mode border (e.g. Amazon product items) */
        body.dark-mode div[style*="border: 1px solid #eee"] p {
            color: var(--text-color-dark) !important;
        }
        body.dark-mode div[style*="border: 1px solid #eee"] { /* Amazon product item border */
            border-color: var(--input-border-dark) !important;
        }
        body.dark-mode div[style*="border: 1px solid #ccc"] { /* Chrome/Edge URL bar container border */
            border-color: var(--input-border-dark) !important;
        }


        /* Custom Cursor */
        #custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 10000;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill="%23000" d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103zM2.25 8.184l3.897 1.67a.5.5 0 0 1 .262.263l1.67 3.897L12.743 3.52z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        body.dark-mode #custom-cursor {
             background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill="%23fff" d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103zM2.25 8.184l3.897 1.67a.5.5 0 0 1 .262.263l1.67 3.897L12.743 3.52z"/></svg>');
        }

        /* Initial Setup Screen */
        #setup-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color-light); color: var(--text-color-light);
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            z-index: 1000; transition: background-color 0.3s, color 0.3s;
            overflow-y: auto; padding: 20px; box-sizing: border-box;
        }
        body.dark-mode #setup-screen { background-color: var(--bg-color-dark); color: var(--text-color-dark); }
        #setup-content {
            background-color: var(--window-bg-light); padding: 40px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center;
            max-width: 500px; width: 90%; transition: background-color 0.3s;
            margin-top: 20px; margin-bottom: 20px;
        }
        body.dark-mode #setup-content { background-color: var(--window-bg-dark); }
        #setup-content h2 { margin-top: 0; margin-bottom: 20px; font-weight: 600; }
        #setup-content label { display: block; margin-bottom: 8px; text-align: left; font-weight: 600; }
        #setup-content input, #setup-content select {
            width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid var(--input-border-light);
            border-radius: 4px; box-sizing: border-box; background-color: var(--input-bg-light);
            color: var(--text-color-light); transition: border-color 0.3s, background-color 0.3s, color 0.3s;
        }
        body.dark-mode #setup-content input, body.dark-mode #setup-content select {
            border-color: var(--input-border-dark); background-color: var(--input-bg-dark); color: var(--text-color-dark);
        }
        #setup-content button {
            padding: 10px 20px; background-color: var(--accent-color); color: white;
            border: none; border-radius: 4px; cursor: pointer; font-size: 1em; transition: background-color 0.2s ease;
        }
        #setup-content button:hover { background-color: #005a9e; }

        /* Password Screen */
        #password-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color-light); color: var(--text-color-light);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 999; transition: background-color 0.3s, color 0.3s;
            overflow-y: auto; padding: 20px; box-sizing: border-box;
        }
        body.dark-mode #password-screen { background-color: var(--bg-color-dark); color: var(--text-color-dark); }
        #password-content {
            background-color: var(--window-bg-light); padding: 40px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center;
            max-width: 400px; width: 90%; transition: background-color 0.3s;
        }
        body.dark-mode #password-content { background-color: var(--window-bg-dark); }
        #password-content h2 { margin-top: 0; margin-bottom: 20px; font-weight: 600; }
        #password-content input {
            width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid var(--input-border-light);
            border-radius: 4px; box-sizing: border-box; background-color: var(--input-bg-light);
            color: var(--text-color-light); transition: border-color 0.3s, background-color 0.3s, color 0.3s;
        }
        body.dark-mode #password-content input {
            border-color: var(--input-border-dark); background-color: var(--input-bg-dark); color: var(--text-color-dark);
        }
        #password-content button {
            padding: 10px 20px; background-color: var(--accent-color); color: white;
            border: none; border-radius: 4px; cursor: pointer; font-size: 1em; transition: background-color 0.2s ease, transform 0.1s ease;
        }
        #password-content button:hover { background-color: #005a9e; }
        #login-button:active {
            transform: scale(0.95);
            background-color: #004578; /* A slightly darker shade for pressed state */
        }
        #password-error { color: red; margin-top: 10px; visibility: hidden; }

        /* Desktop Screen */
        #desktop-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: none; flex-direction: column; justify-content: space-between;
            z-index: 1; overflow: hidden;
        }

        /* Taskbar */
        .taskbar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 48px;
            background-color: var(--taskbar-bg-light); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px; box-sizing: border-box; z-index: 998; transition: background-color 0.3s;
        }
        .taskbar-left { flex: 1; display: flex; align-items: center; gap: 4px; }
        .taskbar-center { display: flex; justify-content: center; align-items: center; }
        .taskbar-icon, .taskbar-app-icon {
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            margin: 0 4px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease, border-bottom 0.2s ease;
        }
        .taskbar-icon:hover, .taskbar-app-icon:hover { background-color: rgba(0, 0, 0, 0.1); }
        body.dark-mode .taskbar-icon:hover, body.dark-mode .taskbar-app-icon:hover { background-color: rgba(255, 255, 255, 0.1); }
        
        .taskbar-app-icon.active {
            border-bottom: 2px solid var(--accent-color);
            background-color: rgba(0, 120, 212, 0.2);
        }
        .taskbar-app-icon svg {
            width: 20px; height: 20px; fill: var(--text-color-light);
        }
        body.dark-mode .taskbar-app-icon svg {
             fill: var(--text-color-dark);
        }

        .start-button-icon { width: 24px; height: 24px; fill: var(--text-color-light); }
        body.dark-mode .start-button-icon { fill: var(--text-color-dark); }
        .search-icon { width: 20px; height: 20px; fill: var(--text-color-light); }
        body.dark-mode .search-icon { fill: var(--text-color-dark); }

        .system-tray { display: flex; align-items: center; flex-shrink: 0; }
        .system-tray-item {
            padding: 0 8px; height: 40px; display: flex; align-items: center;
            border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease;
        }
        .system-tray-item:hover { background-color: rgba(0, 0, 0, 0.1); }
        body.dark-mode .system-tray-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        .system-tray-icon { width: 18px; height: 18px; margin-right: 4px; fill: var(--text-color-light); }
        body.dark-mode .system-tray-icon { fill: var(--text-color-dark); }

        .taskbar-detail-popup {
            position: fixed; bottom: 58px;
            background-color: var(--window-bg-light); border: 1px solid var(--window-border-light);
            border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 15px; z-index: 999; display: none; flex-direction: column;
            min-width: 200px; transition: background-color 0.3s, border-color 0.3s;
        }
        #datetime-popup { right: 10px; }
        #battery-popup { right: 10px; }
        #wifi-popup { right: 10px; }
        body.dark-mode .taskbar-detail-popup {
             background-color: var(--window-bg-dark); border-color: var(--window-border-dark);
        }
        .taskbar-detail-popup h4 { margin-top: 0; margin-bottom: 10px; font-weight: 600; }
        .taskbar-detail-popup p { margin: 5px 0; font-size: 0.9em; }

        #search-bar {
            position: fixed; bottom: 58px; left: 50%;
            width: 500px; max-width: 95%;
            background-color: var(--window-bg-light); border: 1px solid var(--window-border-light);
            border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            padding: 15px; box-sizing: border-box; z-index: 997;
            display: none; flex-direction: column;
            opacity: 0; transform: translateX(-50%) scale(0.95) translateY(20px);
            transition: background-color 0.3s, border-color 0.3s, opacity 0.25s ease-out, transform 0.25s ease-out;
        }
        body.dark-mode #search-bar { background-color: var(--window-bg-dark); border-color: var(--window-border-dark); }
        #search-bar input {
            width: 100%; padding: 10px; border: 1px solid var(--input-border-light);
            border-radius: 4px; box-sizing: border-box; background-color: var(--input-bg-light);
            color: var(--text-color-light); transition: border-color 0.3s, background-color 0.3s, color 0.3s;
        }
        body.dark-mode #search-bar input {
             border-color: var(--input-border-dark); background-color: var(--input-bg-dark); color: var(--text-color-dark);
        }
        #search-bar .search-results { margin-top: 10px; font-size: 0.9em; color: var(--text-color-light); }
        body.dark-mode #search-bar .search-results { color: var(--text-color-dark); }
        #search-results div { padding: 8px; cursor: pointer; border-bottom: 1px solid var(--window-border-light); transition: background-color 0.2s ease; }
        body.dark-mode #search-results div { border-bottom-color: var(--window-border-dark); }
        #search-results div:last-child { border-bottom: none; }
        #search-results div:hover { background-color: rgba(0, 0, 0, 0.05); }
        body.dark-mode #search-results div:hover { background-color: rgba(255, 255, 255, 0.05); }

        .start-menu {
            position: fixed; bottom: 58px; left: 50%;
            width: 500px; max-width: 95%; height: 600px; max-height: calc(100% - 70px);
            background-color: var(--start-menu-bg-light); backdrop-filter: blur(10px);
            border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: none; flex-direction: column; justify-content: space-between;
            padding: 20px; box-sizing: border-box; z-index: 997;
            opacity: 0; transform: translateX(-50%) scale(0.95) translateY(20px);
            transition: background-color 0.3s, opacity 0.25s ease-out, transform 0.25s ease-out;
            overflow-y: auto;
        }
        .start-menu-header {
            display: flex; align-items: center; padding-top: 15px;
            border-top: 1px solid var(--input-border-light);
            margin-top: 15px; width: 100%;
        }
        body.dark-mode .start-menu-header { border-top-color: var(--input-border-dark); }
        .start-menu-header img { width: 36px; height: 36px; border-radius: 50%; margin-right: 10px; }
        .start-menu-header span { font-weight: 600; flex-grow: 1; }
        .power-button-container { margin-left: auto; }
        #start-menu-power-button {
            background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
        }
        #start-menu-power-button svg { width: 22px; height: 22px; fill: var(--text-color-light); }
        body.dark-mode #start-menu-power-button svg { fill: var(--text-color-dark); }
        #start-menu-power-button:hover { background-color: rgba(0,0,0,0.1); }
        body.dark-mode #start-menu-power-button:hover { background-color: rgba(255,255,255,0.1); }

        #power-options-popup {
            position: fixed;
            bottom: 110px;
            left: 50%;
            transform: translateX(calc(-50% + 200px));
            width: 200px;
            background-color: var(--power-options-bg-light);
            border: 1px solid var(--window-border-light);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 999;
            display: none;
            flex-direction: column;
            gap: 8px;
            opacity: 0;
            transition: background-color 0.3s, border-color 0.3s, opacity 0.25s ease-out, transform 0.25s ease-out;
        }
        #power-options-popup button {
            width: 100%; padding: 10px; text-align: left;
            background-color: var(--button-bg-light); color: var(--text-color-light);
            border: 1px solid var(--button-hover-light);
            border-radius: 4px; cursor: pointer; font-size: 0.9em;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        #power-options-popup button:hover { background-color: var(--button-hover-light); }


        .app-list {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px; overflow-y: auto; flex-grow: 1; padding-bottom: 10px;
        }
        .app-icon {
            display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer;
        }
        .app-icon .icon {
            width: 50px; height: 50px; margin-bottom: 5px; border-radius: 8px;
            background-color: var(--button-bg-light); display: flex; align-items: center; justify-content: center;
            font-size: 24px; transition: background-color 0.2s ease;
        }
        body.dark-mode .app-icon .icon { background-color: var(--button-bg-dark); }
        .app-icon .icon:hover { background-color: var(--button-hover-light); }
        body.dark-mode .app-icon .icon:hover { background-color: var(--button-hover-dark); }
        .app-icon .icon svg { width: 30px; height: 30px; fill: var(--text-color-light); }
        body.dark-mode .app-icon .icon svg { fill: var(--text-color-dark); }
        .app-icon span { font-size: 0.9em; word-break: break-word; }

        .window {
            position: absolute; top: 50%; left: 50%;
            background-color: var(--window-bg-light); border: 1px solid var(--window-border-light);
            border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            width: 80%; max-width: 800px; height: 80%; max-height: 600px;
            display: none; flex-direction: column; z-index: 996; overflow: hidden; resize: both;
            min-width: 300px; min-height: 200px;
            opacity: 0; transform: translate(-50%, -50%) scale(0.95) translateY(20px);
            transition: background-color 0.3s, border-color 0.3s, opacity 0.25s ease-out, transform 0.25s ease-out,
                        width 0.2s ease-in-out, height 0.2s ease-in-out, top 0.2s ease-in-out, left 0.2s ease-in-out;
            box-sizing: border-box; /* Ensures padding and border are included in width/height */
        }
        .window-header {
            padding: 10px; background-color: rgba(0, 0, 0, 0.05);
            display: flex; justify-content: space-between; align-items: center;
            cursor: grab; user-select: none;
        }
        body.dark-mode .window-header { background-color: rgba(255, 255, 255, 0.05); }
        .window-title {
            font-weight: 600;
            display: flex; /* Use flexbox for easy alignment */
            align-items: center; /* Vertically align items in the middle */
            flex-grow: 1; /* Allow title to take available space */
        }
        .header-app-icon {
            display: inline-flex; /* Or inline-block, flex helps with SVG alignment */
            align-items: center;
            justify-content: center;
            /* vertical-align: middle; /* Alternative if not using flex on parent */
        }

        .header-app-icon svg {
            /* Styles are set in JS, but can be defaults here too */
            /* width: 16px; height: 16px; margin-right: 8px; */
        }
        .window-buttons {
            display: flex; /* Ensures buttons are in a row */
        }
        .window-buttons button {
            background: none; border: none; font-size: 1.2em; margin-left: 5px; cursor: pointer;
            padding: 5px; border-radius: 4px; transition: background-color 0.2s ease;
            color: var(--text-color-light);
            display: flex; align-items: center; justify-content: center;
        }
        .window-buttons button svg {
            width: 16px; height: 16px;
            fill: currentColor;
        }
        body.dark-mode .window-buttons button { color: var(--text-color-dark); }
        .window-buttons button:hover { background-color: rgba(0, 0, 0, 0.1); }
        body.dark-mode .window-buttons button:hover { background-color: rgba(255, 255, 255, 0.1); }

        .window-content { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .window-content textarea {
            width: 100%; height: 100%; border: none; resize: none;
            font-family: inherit; font-size: 1em; /* Inherit body font */
            box-sizing: border-box; padding: 5px; background-color: var(--input-bg-light); color: var(--text-color-light);
        }
        body.dark-mode .window-content textarea { background-color: var(--input-bg-dark); color: var(--text-color-dark); }

     .google-play-button {
         background-color: var(--button-bg-light);
         color: var(--text-color-light);
         border: 1px solid var(--button-hover-light);
         padding: 10px 20px; 
         border-radius: 4px;  
         cursor: pointer;    
         font-size: 1em;     
         margin: 5px;        
         transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease; 
     }

     .google-play-button:hover {
         background-color: var(--button-hover-light);
         border-color: var(--button-bg-light); 
     }

     body.dark-mode .google-play-button {
         background-color: var(--button-bg-dark);
         color: var(--text-color-dark);
         border-color: var(--button-hover-dark);
     }

     body.dark-mode .google-play-button:hover {
         background-color: var(--button-hover-dark);
         border-color: var(--button-bg-dark); 
     }
     
     /* General button styling within window content - apply if not already styled by more specific rules like .google-play-button or .settings-section button */
     .window-content button:not(#click-button):not(.calculator-button):not(.settings-section button):not(.google-play-button) {
        background-color: var(--button-bg-light);
        color: var(--text-color-light);
        border: 1px solid var(--button-hover-light);
        padding: 8px 15px; 
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
     }
     
     .window-content button:not(#click-button):not(.calculator-button):not(.settings-section button):not(.google-play-button):hover {
        background-color: var(--button-hover-light);
     }

     body.dark-mode .window-content button:not(#click-button):not(.calculator-button):not(.settings-section button):not(.google-play-button) {
         background-color: var(--button-bg-dark);
         color: var(--text-color-dark);
         border-color: var(--button-hover-dark);
     }

     body.dark-mode .window-content button:not(#click-button):not(.calculator-button):not(.settings-section button):not(.google-play-button):hover {
         background-color: var(--button-hover-dark);
     }

        /* Click Game specific styles */
        #click-game-content { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
        #click-button {
            padding: 20px 40px; font-size: 1.5em; background-color: var(--accent-color); color: white;
            border: none; border-radius: 8px; cursor: pointer; margin-bottom: 20px; transition: background-color 0.2s, transform 0.1s;
        }
        #click-button:hover { background-color: #005a9e; }
        #click-button:active { transform: scale(0.95); }
        #click-count { font-size: 2em; font-weight: bold; }
        body.dark-mode #click-button { /* No specific dark mode if accent is universal */ }

        .mc-button { 
            display: block; width: 80%; max-width: 250px; margin: 10px auto; padding: 10px 20px; 
            background-color: rgba(0,0,0,0.5); color: white; border: 1px solid gray; 
            border-radius: 4px; cursor: pointer; font-size: 1em;
        }
        .mc-button:hover { background-color: rgba(0,0,0,0.7); }

        /* Calculator App Styles */
        #calculator-window .window-content {
            display: flex;
            flex-direction: column;
            padding: 0; /* Remove padding for full bleed display/buttons */
        }
        .calculator-display {
            background-color: var(--input-bg-light);
            color: var(--text-color-light);
            text-align: right;
            padding: 20px;
            font-size: 2.5em; /* Larger display font */
            font-weight: 300;
            min-height: 50px;
            border-bottom: 1px solid var(--window-border-light);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        body.dark-mode .calculator-display {
            background-color: var(--input-bg-dark);
            color: var(--text-color-dark);
            border-bottom-color: var(--window-border-dark);
        }
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px; /* Thin lines between buttons */
            flex-grow: 1;
            background-color: var(--window-border-light); /* For grid lines */
        }
        body.dark-mode .calculator-buttons {
            background-color: var(--window-border-dark);
        }
        .calculator-button {
            background-color: var(--calc-button-bg-light);
            color: var(--text-color-light);
            border: none;
            padding: 20px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .calculator-button:hover {
            background-color: var(--calc-button-hover-light);
        }
        body.dark-mode .calculator-button {
            background-color: var(--calc-button-bg-dark);
            color: var(--text-color-dark);
        }
        body.dark-mode .calculator-button:hover {
            background-color: var(--calc-button-hover-dark);
        }

        .calculator-button.operator {
            background-color: var(--calc-operator-bg-light);
        }
        .calculator-button.operator:hover {
            background-color: var(--calc-operator-hover-light);
        }
        body.dark-mode .calculator-button.operator {
            background-color: var(--calc-operator-bg-dark);
        }
        body.dark-mode .calculator-button.operator:hover {
            background-color: var(--calc-operator-hover-dark);
        }
        .calculator-button.equals {
            background-color: var(--calc-equals-bg);
            color: white;
            grid-column: span 2; /* Make equals button wider */
        }
        .calculator-button.equals:hover {
            background-color: var(--calc-equals-hover);
        }
        body.dark-mode .calculator-button.equals {
            /* Keep accent color for equals button in dark mode too */
        }


        #settings-content h3 { margin-top: 0; margin-bottom: 15px; font-weight: 600; }
        .settings-section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--window-border-light); }
        body.dark-mode .settings-section { border-bottom-color: var(--window-border-dark); }
        .settings-section label { display: block; margin-bottom: 8px; font-weight: 600; }
        .settings-section input[type="text"], .settings-section input[type="password"],
        .settings-section input[type="number"], .settings-section input[type="time"],
        .settings-section input[type="date"], .settings-section select {
            width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solid var(--input-border-light);
            border-radius: 4px; box-sizing: border-box; background-color: var(--input-bg-light); color: var(--text-color-light);
            transition: border-color 0.3s, background-color 0.3s, color 0.3s;
        }
        body.dark-mode .settings-section input[type="text"], body.dark-mode .settings-section input[type="password"],
        body.dark-mode .settings-section input[type="number"], body.dark-mode .settings-section input[type="time"],
        body.dark-mode .settings-section input[type="date"], body.dark-mode .settings-section select {
            border-color: var(--input-border-dark); background-color: var(--input-bg-dark); color: var(--text-color-dark);
        }
        .settings-section button {
            padding: 8px 15px; background-color: var(--button-bg-light); color: var(--text-color-light);
            border: 1px solid var(--button-hover-light); border-radius: 4px; cursor: pointer; font-size: 0.9em;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        }
        body.dark-mode .settings-section button {
             background-color: var(--button-bg-dark); color: var(--text-color-dark); border-color: var(--button-hover-dark);
        }
        .settings-section button:hover { background-color: var(--button-hover-light); border-color: var(--button-bg-light); }
        body.dark-mode .settings-section button:hover { background-color: var(--button-hover-dark); border-color: var(--button-bg-dark); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--scrollbar-track-light); }
        ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb-light); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        #shutdown-overlay {
            position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.9); color:white;
            z-index:10001;
            display:flex; flex-direction: column; align-items:center; justify-content:center;
            font-size:1.5em; text-align: center;
            opacity: 0; transition: opacity 0.3s ease-in-out;
        }
         #shutdown-overlay p { margin-top: 20px; }


        @media (max-width: 768px) {
            .taskbar { height: 56px; }
            .taskbar-icon, .taskbar-app-icon { width: 48px; height: 48px; }
            .start-menu {
                width: 100%; left: 0; transform: translateX(0) scale(0.95) translateY(20px);
                border-radius: 0; bottom: 56px; max-height: calc(100% - 56px);
            }
            .window { width: 95%; height: 90%; max-width: 100%; max-height: 100%; }
            .taskbar-detail-popup { right: 50%; transform: translateX(50%); min-width: unset; width: 90%; }
            #search-bar {
                width: 95%; left: 50%; transform: translateX(-50%) scale(0.95) translateY(20px);
            }
            #power-options-popup {
                left: auto; right: 10px;
                transform: scale(0.95) translateY(10px);
                bottom: calc(56px + 10px + 36px + 15px + 15px + 10px);
            }
            .calculator-display { font-size: 2em; padding: 15px; }
            .calculator-button { font-size: 1.2em; padding: 15px;}
        }
    </style>
</head>
<body>

    <div id="custom-cursor"></div>

    <div id="setup-screen">
        <div id="setup-content">
            <h2>Windows 11 セットアップ</h2>
            <div class="settings-section">
                 <label for="setup-language">言語:</label>
                <select id="setup-language">
                    <option value="ja">日本語</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div class="settings-section">
                 <label for="setup-region">地域:</label>
                <select id="setup-region">
                    <option value="JP">日本</option>
                    <option value="US">United States</option>
                </select>
            </div>
            <div class="settings-section">
                <label for="setup-timezone">タイムゾーン:</label>
                <select id="setup-timezone"></select>
            </div>
             <div class="settings-section">
                <label>インターネット設定 (ダミー):</label>
                <p>インターネットに接続しています...</p>
            </div>
            <div class="settings-section">
                <label for="setup-keyboard">キーボード レイアウト:</label>
                <select id="setup-keyboard">
                    <option value="JP">日本語</option>
                    <option value="US">US</option>
                </select>
            </div>
             <div class="settings-section">
                <label for="setup-mouse-icon">マウス アイコン:</label>
                <select id="setup-mouse-icon">
                    <option value="default">デフォルト</option>
                    <option value="pointer">ポインター</option>
                </select>
            </div>
             <div class="settings-section">
                <label for="setup-wallpaper">壁紙:</label>
                <select id="setup-wallpaper">
                    <option value="default">デフォルト (Windows 11)</option>
                    <option value="abstract">抽象画</option>
                </select>
            </div>
             <div class="settings-section">
                <label for="setup-username">ユーザー名:</label>
                <input type="text" id="setup-username" placeholder="ユーザー名を入力">
            </div>
             <div class="settings-section">
                <label for="setup-pcname">PC名:</label>
                <input type="text" id="setup-pcname" placeholder="PC名を入力">
            </div>
            <div class="settings-section">
                <label for="setup-password">パスワード:</label>
                <input type="password" id="setup-password" placeholder="パスワードを入力">
            </div>
            <button id="complete-setup">セットアップ完了</button>
        </div>
    </div>

    <div id="password-screen">
        <div id="password-content">
            <h2>パスワードを入力してください</h2>
            <input type="password" id="login-password" placeholder="パスワード">
            <button id="login-button">ログイン</button>
            <p id="password-error">パスワードが間違っています。</p>
        </div>
    </div>

    <div id="desktop-screen">
        <div class="taskbar">
            <div class="taskbar-left">
                <!-- Running app icons will be injected here -->
            </div>
            <div class="taskbar-center">
                <div class="taskbar-icon" id="start-button">
                     <svg class="start-button-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M7.462 0H0v7.19h7.462zM16 0H8.538v7.19H16zM7.462 8.211H0V16h7.462zm8.538 0H8.538V16H16z"/>
                    </svg>
                </div>
                 <div class="taskbar-icon" id="search-button">
                     <svg class="search-icon bi bi-search" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                       <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                     </svg>
                 </div>
                <div class="taskbar-icon" id="taskbar-settings">
                     <svg class="system-tray-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                      <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                    </svg>
                    </div>
            </div>
            <div class="system-tray">
                <div class="system-tray-item" id="wifi-status">
                    <svg class="system-tray-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.44 12.44 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.52.52 0 0 0 .668.05A11.45 11.45 0 0 1 8 4c2.507 0 4.827.802 6.716 2.164.205.148.49.13.668-.049"/>
                      <path d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.46 9.46 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.576 1.336c.206.132.48.108.653-.065m-2.183 2.183c.226-.226.185-.605-.1-.75A6.5 6.5 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.407.19.611.09A5.5 5.5 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.61-.091zM9.06 12.44c.196-.196.198-.52-.04-.66A2 2 0 0 0 8 11.5a2 2 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .707 0l.707-.707z"/>
                    </svg>
                </div>
                <div class="system-tray-item" id="battery-status">
                     <svg class="system-tray-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M9.585 2.568a.5.5 0 0 1 .226.58L8.677 6.832h1.99a.5.5 0 0 1 .364.843l-5.334 5.667a.5.5 0 0 1-.842-.49L5.99 9.167H4a.5.5 0 0 1-.364-.843l5.333-5.667a.5.5 0 0 1 .616-.09z"/>
                      <path d="M2 4h4.332l-.94 1H2a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h2.38l-.308 1H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"/>
                      <path d="M2 6h2.45L2.908 7.639A1.5 1.5 0 0 0 3.313 10H2zm8.595-2-.308 1H12a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H9.276l-.942 1H12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/>
                      <path d="M12 10h-1.783l1.542-1.639q.146-.156.241-.34zm0-3.354V6h-.646a1.5 1.5 0 0 1 .646.646M16 8a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8"/>
                    </svg>
                    <span id="battery-level">100%</span>
                </div>
                <div class="system-tray-item" id="time-display"></div>
                <div class="system-tray-item" id="date-display"></div>
            </div>
        </div>

        <div class="taskbar-detail-popup" id="datetime-popup">
            <h4>日時</h4>
            <p id="popup-datetime"></p>
            <p>地域: <span id="popup-region"></span></p>
            <p>言語: <span id="popup-language"></span></p>
        </div>
        
        <div class="taskbar-detail-popup" id="wifi-popup">
            <h4>Wi-Fi</h4>
            <p>状態: 接続済み (ダミー)</p>
            <p>ネットワーク: HomeNetwork_5G</p>
        </div>

        <div class="taskbar-detail-popup" id="battery-popup">
            <h4>バッテリー</h4>
            <p>レベル: <span id="popup-battery-level"></span></p>
            <p>状態: <span id="popup-battery-status"></span></p>
        </div>

        <div id="search-bar">
            <input type="text" id="search-input" placeholder="検索...">
            <div class="search-results" id="search-results">
                <p>ここに検索結果が表示されます。</p>
            </div>
        </div>


        <div class="start-menu" id="start-menu">
            <div class="app-list">
                <div class="app-icon" data-app="calculator">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                          <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                    </div>
                    <span>電卓</span>
                </div>
                <div class="app-icon" data-app="chrome">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M16 8a8 8 0 0 1-7.022 7.94l1.902-7.098a3 3 0 0 0 .05-1.492A3 3 0 0 0 10.237 6h5.511A8 8 0 0 1 16 8M0 8a8 8 0 0 0 7.927 8l1.426-5.321a3 3 0 0 1-.723.255 3 3 0 0 1-1.743-.147 3 3 0 0 1-1.043-.7L.633 4.876A8 8 0 0 0 0 8m5.004-.167L1.108 3.936A8.003 8.003 0 0 1 15.418 5H8.066a3 3 0 0 0-1.252.243 2.99 2.99 0 0 0-1.81 2.59M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                        </svg>
                    </div>
                    <span>Google Chrome</span>
                </div>
                 <div class="app-icon" data-app="minecraft-bedrock">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                        </svg>
                    </div>
                    <span>Minecraft Bedrock</span>
                </div>
                <div class="app-icon" data-app="minecraft-java">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5 8 5.961 14.154 3.5zM15 4.239l-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                        </svg>
                    </div>
                    <span>Minecraft Java</span>
                </div>
                <div class="app-icon" data-app="amazon">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M10.813 11.968c.157.083.36.074.5-.05l.005.005a90 90 0 0 1 1.623-1.405c.173-.143.143-.372.006-.563l-.125-.17c-.345-.465-.673-.906-.673-1.791v-3.3l.001-.335c.008-1.265.014-2.421-.933-3.305C10.404.274 9.06 0 8.03 0 6.017 0 3.77.75 3.296 3.24c-.047.264.143.404.316.443l2.054.22c.19-.009.33-.196.366-.387.176-.857.896-1.271 1.703-1.271.435 0 .929.16 1.188.55.264.39.26.91.257 1.376v.432q-.3.033-.621.065c-1.113.114-2.397.246-3.36.67C3.873 5.91 2.94 7.08 2.94 8.798c0 2.2 1.387 3.298 3.168 3.298 1.506 0 2.328-.354 3.489-1.54l.167.246c.274.405.456.675 1.047 1.166ZM6.03 8.431C6.03 6.627 7.647 6.3 9.177 6.3v.57c.001.776.002 1.434-.396 2.133-.336.595-.87.961-1.465.961-.812 0-1.286-.619-1.286-1.533M.435 12.174c2.629 1.603 6.698 4.084 13.183.997.28-.116.475.078.199.431C13.538 13.96 11.312 16 7.57 16 3.832 16 .968 13.446.094 12.386c-.24-.275.036-.4.199-.299z"/>
                          <path d="M13.828 11.943c.567-.07 1.468-.027 1.645.204.135.176-.004.966-.233 1.533-.23.563-.572.961-.762 1.115s-.333.094-.23-.137c.105-.23.684-1.663.455-1.963-.213-.278-1.177-.177-1.625-.13l-.09.009q-.142.013-.233.024c-.193.021-.245.027-.274-.032-.074-.209.779-.556 1.347-.623"/>
                        </svg>
                    </div>
                    <span>Amazon</span>
                </div>
                <div class="app-icon" data-app="click-game">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103zM2.25 8.184l3.897 1.67a.5.5 0 0 1 .262.263l1.67 3.897L12.743 3.52z"/>
                        </svg>
                    </div>
                    <span>クリックゲーム</span>
                </div>
                 <div class="app-icon" data-app="settings">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                          <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                        </svg>
                    </div>
                    <span>設定</span>
                </div>
                 <div class="app-icon" data-app="microsoft-store">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.37 2.37 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0M1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5M4 15h3v-5H4zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zm3 0h-2v3h2z"/>
                        </svg>
                    </div>
                    <span>Microsoft Store</span>
                </div>
                <div class="app-icon" data-app="notepad">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5"/>
                          <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
                        </svg>
                    </div>
                    <span>メモ帳</span>
                </div>
                 <div class="app-icon" data-app="roblox">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M7.752.066a.5.5 0 0 1 .496 0l3.75 2.143a.5.5 0 0 1 .252.434v3.995l3.498 2A.5.5 0 0 1 16 9.07v4.286a.5.5 0 0 1-.252.434l-3.75 2.143a.5.5 0 0 1-.496 0l-3.502-2-3.502 2.001a.5.5 0 0 1-.496 0l-3.75-2.143A.5.5 0 0 1 0 13.357V9.071a.5.5 0 0 1 .252-.434L3.75 6.638V2.643a.5.5 0 0 1 .252-.434zM4.25 7.504 1.508 9.071l2.742 1.567 2.742-1.567zM7.5 9.933l-2.75 1.571v3.134l2.75-1.571zm1 3.134 2.75 1.571v-3.134L8.5 9.933zm.508-3.996 2.742 1.567 2.742-1.567-2.742-1.567zm2.242-2.433V3.504L8.5 5.076V8.21zM7.5 8.21V5.076L4.75 3.504v3.134zM5.258 2.643 8 4.21l2.742-1.567L8 1.076zM15 9.933l-2.75 1.571v3.134L15 13.067zM3.75 14.638v-3.134L1 9.933v3.134z"/>
                        </svg>
                    </div>
                    <span>Roblox</span>
                </div>
                 <div class="app-icon" data-app="x">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z"/>
                        </svg>
                    </div>
                    <span>X</span>
                </div>
                 <div class="app-icon" data-app="youtube">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.01 2.01 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.01 2.01 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31 31 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.01 2.01 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A100 100 0 0 1 7.858 2zM6.4 5.209v4.818l4.157-2.408z"/>
                        </svg>
                    </div>
                    <span>YouTube</span>
                </div>
                 <div class="app-icon" data-app="google-meet">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
                          <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0 4"/>
                        </svg>
                    </div>
                    <span>Google Meet</span>
                </div>
                 <div class="app-icon" data-app="google-drive">
                    <div class="icon">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
                        </svg>
                    </div>
                    <span>Google Drive</span>
                </div>
                <!-- NEW APPS START HERE -->
                <div class="app-icon" data-app="bing">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8.35 5.046a.615.615 0 0 0-.54.575c-.009.13-.006.14.289.899.67 1.727.833 2.142.86 2.2q.101.215.277.395c.089.092.148.141.247.208.176.117.262.15.944.351.664.197 1.026.327 1.338.482.405.201.688.43.866.7.128.195.242.544.291.896.02.137.02.44 0 .564-.041.27-.124.495-.252.684-.067.1-.044.084.055-.039.278-.346.562-.938.707-1.475a4.42 4.42 0 0 0-2.14-5.028 70 70 0 0 0-.888-.465l-.53-.277-.353-.184c-.16-.082-.266-.138-.345-.18-.368-.192-.523-.27-.568-.283a1 1 0 0 0-.194-.03z"/>
                          <path d="M9.152 11.493a3 3 0 0 0-.135.083 320 320 0 0 0-1.513.934l-.8.496c-.012.01-.587.367-.876.543a1.9 1.9 0 0 1-.732.257c-.12.017-.349.017-.47 0a1.9 1.9 0 0 1-.884-.358 2.5 2.5 0 0 1-.365-.364 1.9 1.9 0 0 1-.34-.76 1 1 0 0 0-.027-.121c-.005-.006.004.092.022.22.018.132.057.324.098.489a4.1 4.1 0 0 0 2.487 2.796c.359.142.72.23 1.114.275.147.016.566.023.72.011a4.1 4.1 0 0 0 1.956-.661l.235-.149.394-.248.258-.163 1.164-.736c.51-.32.663-.433.9-.665.099-.097.248-.262.255-.283.002-.005.028-.046.059-.091a1.64 1.64 0 0 0 .25-.682c.02-.124.02-.427 0-.565a3 3 0 0 0-.213-.758c-.15-.314-.47-.6-.928-.83a2 2 0 0 0-.273-.12c-.006 0-.433.26-.948.58l-1.113.687z"/>
                          <path d="m3.004 12.184.03.129c.089.402.245.693.515.963a1.82 1.82 0 0 0 1.312.543c.361 0 .673-.09.994-.287l.472-.29.373-.23V5.334c0-1.537-.003-2.45-.008-2.521a1.82 1.82 0 0 0-.535-1.177c-.097-.096-.18-.16-.427-.33L4.183.24c-.239-.163-.258-.175-.33-.2a.63.63 0 0 0-.842.464c-.009.042-.01.603-.01 3.646l.003 8.035Z"/>
                        </svg>
                    </div>
                    <span>Bing</span>
                </div>
                 <div class="app-icon" data-app="xbox">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" fill="currentColor" class="bi bi-xbox" viewBox="0 0 16 16">
                          <path d="M7.202 15.967a8 8 0 0 1-3.552-1.26c-.898-.585-1.101-.826-1.101-1.306 0-.965 1.062-2.656 2.879-4.583C6.459 7.723 7.897 6.44 8.052 6.475c.302.068 2.718 2.423 3.622 3.531 1.43 1.753 2.088 3.189 1.754 3.829-.254.486-1.83 1.437-2.987 1.802-.954.301-2.207.429-3.239.33m-5.866-3.57C.589 11.253.212 10.127.03 8.497c-.06-.539-.038-.846.137-1.95.218-1.377 1.002-2.97 1.945-3.95.401-.417.437-.427.926-.263.595.2 1.23.638 2.213 1.528l.574.519-.313.385C4.056 6.553 2.52 9.086 1.94 10.653c-.315.852-.442 1.707-.306 2.063.091.24.007.15-.3-.319Zm13.101.195c.074-.36-.019-1.02-.238-1.687-.473-1.443-2.055-4.128-3.508-5.953l-.457-.575.494-.454c.646-.593 1.095-.948 1.58-1.25.381-.237.927-.448 1.161-.448.145 0 .654.528 1.065 1.104a8.4 8.4 0 0 1 1.343 3.102c.153.728.166 2.286.024 3.012a9.5 9.5 0 0 1-.6 1.893c-.179.393-.624 1.156-.82 1.404-.1.128-.1.127-.043-.148ZM7.335 1.952c-.67-.34-1.704-.705-2.276-.803a4 4 0 0 0-.759-.043c-.471.024-.45 0 .306-.358A7.8 7.8 0 0 1 6.47.128c.8-.169 2.306-.17 3.094-.005.85.18 1.853.552 2.418.9l.168.103-.385-.02c-.766-.038-1.88.27-3.078.853-.361.176-.676.316-.699.312a12 12 0 0 1-.654-.319Z"/>
                        </svg>
                    </div>
                    <span>Xbox</span>
                </div>
                 <div class="app-icon" data-app="teams">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M9.186 4.797a2.42 2.42 0 1 0-2.86-2.448h1.178c.929 0 1.682.753 1.682 1.682zm-4.295 7.738h2.613c.929 0 1.682-.753 1.682-1.682V5.58h2.783a.7.7 0 0 1 .682.716v4.294a4.197 4.197 0 0 1-4.093 4.293c-1.618-.04-3-.99-3.667-2.35Zm10.737-9.372a1.674 1.674 0 1 1-3.349 0 1.674 1.674 0 0 1 3.349 0m-2.238 9.488-.12-.002a5.2 5.2 0 0 0 .381-2.07V6.306a1.7 1.7 0 0 0-.15-.725h1.792c.39 0 .707.317.707.707v3.765a2.6 2.6 0 0 1-2.598 2.598z"/>
                          <path d="M.682 3.349h6.822c.377 0 .682.305.682.682v6.822a.68.68 0 0 1-.682.682H.682A.68.68 0 0 1 0 10.853V4.03c0-.377.305-.682.682-.682Zm5.206 2.596v-.72h-3.59v.72h1.357V9.66h.87V5.945z"/>
                        </svg>
                    </div>
                    <span>Microsoft Teams</span>
                </div>
                 <div class="app-icon" data-app="github">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
                        </svg>
                    </div>
                    <span>GitHub</span>
                </div>
                 <div class="app-icon" data-app="google">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.545 6.558a9.4 9.4 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.7 7.7 0 0 1 5.352 2.082l-2.284 2.284A4.35 4.35 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.8 4.8 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.7 3.7 0 0 0 1.599-2.431H8v-3.08z"/>
                        </svg>
                    </div>
                    <span>Google</span>
                </div>
                 <div class="app-icon" data-app="google-play">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M14.222 9.374c1.037-.61 1.037-2.137 0-2.748L11.528 5.04 8.32 8l3.207 2.96zm-3.595 2.116L7.583 8.68 1.03 14.73c.201 1.029 1.36 1.61 2.303 1.055zM1 13.396V2.603L6.846 8zM1.03 1.27l6.553 6.05 3.044-2.81L3.333.215C2.39-.341 1.231.24 1.03 1.27"/>
                        </svg>
                    </div>
                    <span>Google Play</span>
                </div>
                 <div class="app-icon" data-app="calendar">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                        </svg>
                    </div>
                    <span>カレンダー</span>
                </div>
                 <div class="app-icon" data-app="wikipedia">
                    <div class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8.835 3.003c.828-.006 2.688 0 2.688 0l.033.03v.288q0 .12-.133.12c-.433.02-.522.063-.68.29-.087.126-.258.393-.435.694l-1.52 2.843-.043.089 1.858 3.801.113.031 2.926-6.946q.152-.42-.044-.595c-.132-.114-.224-.18-.563-.195l-.275-.014a.16.16 0 0 1-.096-.035.1.1 0 0 1-.046-.084v-.289l.042-.03h3.306l.034.03v.29q0 .117-.133.117-.65.03-.962.281a1.64 1.64 0 0 0-.488.704s-2.691 6.16-3.612 8.208c-.353.672-.7.61-1.004-.019A224 224 0 0 1 8.044 8.81c-.623 1.285-1.475 3.026-1.898 3.81-.411.715-.75.622-1.02.019-.45-1.065-1.131-2.519-1.817-3.982-.735-1.569-1.475-3.149-1.943-4.272-.167-.4-.293-.657-.412-.759q-.18-.15-.746-.18Q0 3.421 0 3.341v-.303l.034-.03c.615-.003 3.594 0 3.594 0l.034.03v.288q0 .119-.15.118l-.375.016q-.483.02-.483.288-.002.125.109.4c.72 1.753 3.207 6.998 3.207 6.998l.091.023 1.603-3.197-.32-.71L6.24 5.095s-.213-.433-.286-.577l-.098-.196c-.387-.77-.411-.82-.865-.88-.137-.017-.208-.035-.208-.102v-.304l.041-.03h2.853l.075.024v.303q0 .104-.15.104l-.206.03c-.523.04-.438.254-.09.946l1.057 2.163 1.17-2.332c.195-.427.155-.534.074-.633-.046-.055-.202-.144-.54-.158l-.133-.015a.16.16 0 0 1-.096-.034.1.1 0 0 1-.045-.085v-.288l.041-.03Z"/>
                        </svg>
                    </div>
                    <span>Wikipedia</span>
                </div>
                <!-- NEW APPS END HERE -->
            </div>
            <div class="start-menu-header">
                <img id="start-menu-user-avatar" src="https://placehold.co/36x36/cccccc/000?text=U" alt="User Icon">
                <span id="start-menu-username">ユーザー</span>
                <div class="power-button-container">
                    <button id="start-menu-power-button" title="電源">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M7.5 1v7h1V1z"/>
                          <path d="M3 8.812a5 5 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="power-options-popup">
            <button id="restart-button">再起動</button>
            <button id="shutdown-button">シャットダウン</button>
        </div>

        <!-- Calculator App Window -->
        <div class="window" id="calculator-window" style="max-width: 400px; max-height:500px; min-width: 280px; min-height: 380px;">
            <div class="window-header">
                <span class="window-title">電卓</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content">
                <div class="calculator-display" id="calculator-display">0</div>
                <div class="calculator-buttons">
                    <button class="calculator-button operator" data-value="clear">AC</button>
                    <button class="calculator-button operator" data-value="backspace">⌫</button>
                    <button class="calculator-button operator" data-value="%">%</button>
                    <button class="calculator-button operator" data-value="/">÷</button>

                    <button class="calculator-button number" data-value="7">7</button>
                    <button class="calculator-button number" data-value="8">8</button>
                    <button class="calculator-button number" data-value="9">9</button>
                    <button class="calculator-button operator" data-value="*">×</button>

                    <button class="calculator-button number" data-value="4">4</button>
                    <button class="calculator-button number" data-value="5">5</button>
                    <button class="calculator-button number" data-value="6">6</button>
                    <button class="calculator-button operator" data-value="-">−</button>

                    <button class="calculator-button number" data-value="1">1</button>
                    <button class="calculator-button number" data-value="2">2</button>
                    <button class="calculator-button number" data-value="3">3</button>
                    <button class="calculator-button operator" data-value="+">+</button>

                    <button class="calculator-button number" data-value="0">0</button>
                    <button class="calculator-button number" data-value=".">.</button>
                    <button class="calculator-button equals" data-value="=">=</button>
                </div>
            </div>
        </div>


        <div class="window" id="chrome-window">
            <div class="window-header">
                <span class="window-title">Google Chrome</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://google.com" style="width: 100%; height: 100%; border: none;" title="Google Chrome"></iframe>
            </div>
        </div>

         <div class="window" id="minecraft-bedrock-window">
            <div class="window-header">
                <span class="window-title">Minecraft Bedrock Edition</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" id="mc-bedrock-content" style="text-align: center; background-image: url('https://placehold.co/800x600/2E8B57/fff?text=Minecraft+Bedrock'); background-size: cover; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
                <div id="mc-bedrock-main-menu" style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%;">
                    <h1 style="color: var(--text-color-dark); text-shadow: 2px 2px #333;">Minecraft Bedrock Edition</h1>
                    <p id="mc-bedrock-version" style="color: #ccc; text-shadow: 1px 1px #222; margin-top: -10px; margin-bottom: 20px;">V1.0.0</p>
                    <button id="mc-bedrock-singleplayer" class="mc-button">シングルプレイ</button>
                    <button id="mc-bedrock-multiplayer" class="mc-button">マルチプレイ</button>
                    <button id="mc-bedrock-marketplace" class="mc-button">マーケットプレイス</button>
                    <button id="mc-bedrock-realms" class="mc-button">Realms</button>
                    <button id="mc-bedrock-skins" class="mc-button">スキン</button>
                    <button id="mc-bedrock-settings" class="mc-button">設定</button>
                </div>
                <div id="mc-bedrock-dynamic-content" style="margin-top: 20px; background-color: rgba(0,0,0,0.7); padding: 15px; border-radius: 5px; display: none; min-width: 300px; color: white;">
                    <!-- Messages or World Selection will appear here -->
                </div>
            </div>
        </div>
        <div class="window" id="minecraft-java-window">
            <div class="window-header">
                <span class="window-title">Minecraft Java Edition</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" id="mc-java-content" style="text-align: center; background-image: url('https://placehold.co/800x600/A0522D/fff?text=Minecraft+Java'); background-size: cover; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
                <div id="mc-java-main-menu" style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%;">
                    <h1 style="color: var(--text-color-dark); text-shadow: 2px 2px #333;">Minecraft Java Edition</h1>
                    <p id="mc-java-version" style="color: #ccc; text-shadow: 1px 1px #222; margin-top: -10px; margin-bottom: 20px;">V1.0.0</p>
                    <button id="mc-java-singleplayer" class="mc-button">Singleplayer</button>
                    <button id="mc-java-multiplayer" class="mc-button">Multiplayer</button>
                    <button id="mc-java-realms" class="mc-button">Minecraft Realms</button>
                    <button id="mc-java-skins" class="mc-button">Skins</button>
                    <button id="mc-java-settings" class="mc-button">Options...</button>
                    <button id="mc-java-installations" class="mc-button">Installations</button>
                </div>
                <div id="mc-java-dynamic-content" style="margin-top: 20px; background-color: rgba(0,0,0,0.7); padding: 15px; border-radius: 5px; display: none; min-width: 300px; color: white;">
                    <!-- Messages or World Selection will appear here -->
                </div>
            </div>
        </div>
        <div class="window" id="amazon-window">
            <div class="window-header">
                <span class="window-title">Amazon</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.amazon.co.jp/ref=nav_logo" style="width: 100%; height: 100%; border: none;" title="Amazon"></iframe>
            </div>
        </div>
        <div class="window" id="click-game-window">
            <div class="window-header">
                <span class="window-title">クリックゲーム</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" id="click-game-content">
                <button id="click-button">クリック！</button>
                <p>スコア: <span id="click-count">0</span></p> <!-- click-count will inherit from body.dark-mode .window-content -->
            </div>
        </div>

         <div class="window" id="microsoft-store-window">
            <div class="window-header">
                <span class="window-title">Microsoft Store</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://apps.microsoft.com/?hl=ja-JP&gl=JP" style="width: 100%; height: 100%; border: none;" title="Microsoft Store"></iframe>
            </div>
        </div>

        <div class="window" id="notepad-window">
            <div class="window-header">
                <span class="window-title">無題 - メモ帳</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content">
                <textarea placeholder="ここにテキストを入力..."></textarea>
            </div>
        </div>
         <div class="window" id="roblox-window">
            <div class="window-header">
                <span class="window-title">Roblox</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.roblox.com/" style="width: 100%; height: 100%; border: none;" title="Roblox"></iframe>
            </div>
        </div>

         <div class="window" id="x-window">
            <div class="window-header">
                <span class="window-title">X</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://x.com/" style="width: 100%; height: 100%; border: none;" title="X"></iframe>
            </div>
        </div>

         <div class="window" id="youtube-window">
            <div class="window-header">
                <span class="window-title">YouTube</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.youtube.com/" style="width: 100%; height: 100%; border: none;" title="YouTube"></iframe>
            </div>
        </div>

         <div class="window" id="google-meet-window">
            <div class="window-header">
                <span class="window-title">Google Meet</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://meet.google.com/landing" style="width: 100%; height: 100%; border: none;" title="Google Meet"></iframe>
            </div>
        </div>

         <div class="window" id="google-drive-window">
            <div class="window-header">
                <span class="window-title">Google Drive</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://drive.google.com/drive/home" style="width: 100%; height: 100%; border: none;" title="Google Drive"></iframe>
            </div>
        </div>

        <div class="window" id="settings-window">
            <div class="window-header">
                <span class="window-title">設定</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" id="settings-content">
                <h3>システム</h3>
                 <div class="settings-section">
                    <label for="settings-language">言語:</label>
                    <select id="settings-language">
                        <option value="ja">日本語</option>
                        <option value="en">English</option>
                    </select>
                </div>

                <div class="settings-section">
                    <label for="settings-region">地域:</label>
                    <select id="settings-region">
                        <option value="JP">日本</option>
                        <option value="US">United States</option>
                    </select>
                </div>

                 <div class="settings-section">
                    <label>インターネット設定 (ダミー):</label>
                    <p>現在の状態: 接続済み (ダミー)</p>
                    <button>接続設定を開く (ダミー)</button>
                </div>

                <h3>時刻と言語</h3>
                <div class="settings-section">
                    <label for="settings-timezone">タイムゾーン:</label>
                    <select id="settings-timezone"></select>
                </div>
                 <div class="settings-section">
                    <label for="settings-keyboard">キーボード レイアウト:</label>
                    <select id="settings-keyboard">
                        <option value="JP">日本語</option>
                        <option value="US">US</option>
                    </select>
                </div>

                <h3>デバイス</h3>
                 <div class="settings-section">
                    <label for="settings-mouse-icon">マウス アイコン:</label>
                    <select id="settings-mouse-icon">
                        <option value="default">デフォルト</option>
                        <option value="pointer">ポインター</option>
                    </select>
                </div>

                <h3>個人用設定</h3>
                 <div class="settings-section">
                    <label for="settings-wallpaper">壁紙:</label>
                    <select id="settings-wallpaper">
                        <option value="default">デフォルト (Windows 11)</option>
                        <option value="abstract">抽象画</option>
                    </select>
                </div>

                <h3>アカウント</h3>
                 <div class="settings-section">
                    <label for="settings-username">ユーザー名:</label>
                    <input type="text" id="settings-username" placeholder="ユーザー名">
                    <button id="apply-username">適用</button>
                </div>

                 <div class="settings-section">
                    <label for="settings-pcname">PC名:</label>
                    <input type="text" id="settings-pcname" placeholder="PC名">
                    <button id="apply-pcname">適用</button>
                </div>

                 <div class="settings-section">
                    <label for="settings-password">パスワード:</label>
                    <input type="password" id="settings-password" placeholder="新しいパスワード">
                    <button id="apply-password">パスワード設定</button>
                </div>
            </div>
        </div>
        
        <!-- NEW APP WINDOWS START HERE -->
        <div class="window" id="bing-window">
            <div class="window-header">
                <span class="window-title">Bing</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.bing.com/" style="width: 100%; height: 100%; border: none;" title="Bing"></iframe>
              </div>
            </div>
        </div>
        <div class="window" id="xbox-window">
            <div class="window-header">
                <span class="window-title">Xbox</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.xbox.com/ja-JP" style="width: 100%; height: 100%; border: none;" title="Xbox"></iframe>
              </div>
            </div>
        </div>
        <div class="window" id="teams-window">
            <div class="window-header">
                <span class="window-title">Microsoft Teams</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.microsoft.com/ja-jp/microsoft-teams/log-in" style="width: 100%; height: 100%; border: none;" title="Microsoft Teams"></iframe>
              </div>
            </div>
        </div>
        <div class="window" id="github-window">
            <div class="window-header">
                <span class="window-title">GitHub</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://github.com/" style="width: 100%; height: 100%; border: none;" title="GitHub"></iframe>
              </div>
            </div>
        </div>
        <div class="window" id="google-window">
            <div class="window-header">
                <span class="window-title">Google</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://google.com" style="width: 100%; height: 100%; border: none;" title="Google"></iframe>
            </div>
        </div>
        <div class="window" id="google-play-window">
            <div class="window-header">
                <span class="window-title">Google Play</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://play.google.com/store/games?hl=ja" style="width: 100%; height: 100%; border: none;" title="Google Play"></iframe>
              </div>
            </div>
        </div>
        <div class="window" id="calendar-window">
            <div class="window-header">
                <span class="window-title">カレンダー</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content">
              <div style="padding: 10px;" id="calendar-app-content">
                <h2 style="text-align: center; margin-bottom: 15px; font-weight: 600;">カレンダー</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                  <button id="calendar-prev-month-btn" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">&lt;</button>
                  <span id="calendar-month-year-display" style="font-size: 1.2em; font-weight: 500;">2024年 7月</span>
                  <button id="calendar-next-month-btn" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">&gt;</button>
                </div>
                <div id="calendar-day-headers" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center;">
                  <div style="font-weight: 500;">日</div> <div style="font-weight: 500;">月</div> <div style="font-weight: 500;">火</div> <div style="font-weight: 500;">水</div> <div style="font-weight: 500;">木</div> <div style="font-weight: 500;">金</div> <div style="font-weight: 500;">土</div>
                </div>
                <div id="calendar-days-body" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; min-height: 180px; /* Adjust as needed */">
                  <!-- Day cells will be populated here by JavaScript -->
                </div>
              </div>
            </div>
        </div>
        <div class="window" id="wikipedia-window">
            <div class="window-header">
                <span class="window-title">Wikipedia</span>
                <div class="window-buttons">
                    <button class="minimize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/></svg></button>
                    <button class="maximize-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg></button>
                    <button class="close-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></button>
                </div>
            </div>
            <div class="window-content" style="padding: 0; overflow: hidden;">
                <iframe src="https://www.wikipedia.org/" style="width: 100%; height: 100%; border: none;" title="Wikipedia"></iframe>
            </div>
        </div>
        <!-- NEW APP WINDOWS END HERE -->
    </div>
    <div id="shutdown-overlay" style="display:none;">
        <span id="shutdown-message-text"></span>
        <p id="shutdown-message-subtext" style="font-size: 0.6em;"></p>
    </div>


    <script>
        // State variables
        let isSetupComplete = localStorage.getItem('setupComplete') === 'true';

        // Minecraft Bedrock App Logic (added here for proximity to other app logic)
        // Note: Ensure mcBedrockContent is defined after the DOM is loaded, or this block is within window.onload / DOMContentLoaded
        // For this subtask, we assume it will be correctly placed or handled by existing onload structure.
        // The actual querySelector calls will be done post-load in the example.
        let storedPassword = localStorage.getItem('password') || '';
        let currentUsername = localStorage.getItem('username') || 'ユーザー';
        let currentPcName = localStorage.getItem('pcName') || 'MY-PC';
        let currentLanguage = localStorage.getItem('language') || 'ja';
        let currentRegion = localStorage.getItem('region') || 'JP';
        let currentKeyboard = localStorage.getItem('keyboard') || 'JP';
        let currentMouseIcon = localStorage.getItem('mouseIcon') || 'default';
        let currentWallpaper = localStorage.getItem('wallpaper') || 'default';
        let currentDate, currentTime;
        let currentTimezone = localStorage.getItem('timezone') || '0';

        // DOM Elements
        const setupScreen = document.getElementById('setup-screen');
        const passwordScreen = document.getElementById('password-screen');
        const desktopScreen = document.getElementById('desktop-screen');
        const customCursor = document.getElementById('custom-cursor');
        const startButton = document.getElementById('start-button');
        const startMenu = document.getElementById('start-menu');
        const timeDisplay = document.getElementById('time-display');
        const dateDisplay = document.getElementById('date-display');
        const batteryStatusItem = document.getElementById('battery-status');
        const batteryLevelDisplay = document.getElementById('battery-level');
        const wifiStatusItem = document.getElementById('wifi-status'); // New Wi-Fi item
        const settingsWindow = document.getElementById('settings-window');
        const startMenuUserAvatar = document.getElementById('start-menu-user-avatar');
        const startMenuUsername = document.getElementById('start-menu-username');
        const taskbarSettingsIcon = document.getElementById('taskbar-settings');
        const taskbarLeft = document.querySelector('.taskbar-left'); // For running apps
        const searchButton = document.getElementById('search-button');
        const searchBar = document.getElementById('search-bar');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');

        const datetimePopup = document.getElementById('datetime-popup');
        const batteryPopup = document.getElementById('battery-popup');
        const wifiPopup = document.getElementById('wifi-popup'); // New Wi-Fi popup
        const popupDatetime = document.getElementById('popup-datetime');
        const popupRegion = document.getElementById('popup-region');
        const popupLanguage = document.getElementById('popup-language');
        const popupBatteryLevel = document.getElementById('popup-battery-level');
        const popupBatteryStatus = document.getElementById('popup-battery-status');

        const startMenuPowerButton = document.getElementById('start-menu-power-button');
        const powerOptionsPopup = document.getElementById('power-options-popup');
        const shutdownButton = document.getElementById('shutdown-button');
        const restartButton = document.getElementById('restart-button');
        const shutdownOverlay = document.getElementById('shutdown-overlay');
        const shutdownMessageText = document.getElementById('shutdown-message-text');
        const shutdownMessageSubtext = document.getElementById('shutdown-message-subtext');


        const setupLanguage = document.getElementById('setup-language');
        const setupRegion = document.getElementById('setup-region');
        const setupKeyboard = document.getElementById('setup-keyboard');
        const setupMouseIcon = document.getElementById('setup-mouse-icon');
        const setupWallpaper = document.getElementById('setup-wallpaper');
        const setupUsernameInput = document.getElementById('setup-username');
        const setupPcNameInput = document.getElementById('setup-pcname');
        const setupPasswordInput = document.getElementById('setup-password');
        const completeSetupButton = document.getElementById('complete-setup');

        const loginPasswordInput = document.getElementById('login-password');
        const loginButton = document.getElementById('login-button');
        const passwordError = document.getElementById('password-error');

        const settingsLanguage = document.getElementById('settings-language');
        const settingsRegion = document.getElementById('settings-region');
        // settingsDate and settingsTime are removed as per instructions
        const settingsKeyboard = document.getElementById('settings-keyboard');
        const settingsMouseIcon = document.getElementById('settings-mouse-icon');
        const settingsWallpaper = document.getElementById('settings-wallpaper');
        const settingsUsernameInput = document.getElementById('settings-username');
        const settingsPcNameInput = document.getElementById('settings-pcname');
        const settingsPasswordInput = document.getElementById('settings-password');
        // applyDateButton and applyTimeButton are removed as per instructions
        const applyUsernameButton = document.getElementById('apply-username');
        const applyPcNameButton = document.getElementById('apply-pcname');
        const applyPasswordButton = document.getElementById('apply-password');

        const appIcons = document.querySelectorAll('.app-icon');
        const taskbarClickState = {}; // Added for taskbar click state tracking

        // --- Calendar App Logic ---
        const prevMonthBtn = document.getElementById('calendar-prev-month-btn');
        const nextMonthBtn = document.getElementById('calendar-next-month-btn');
        const monthYearDisplay = document.getElementById('calendar-month-year-display');

        let currentCalendarYear;
        let currentCalendarMonth; // 0-indexed (0 for January, 11 for December)

        function initializeCalendarState() {
            if (monthYearDisplay) {
                const initialText = monthYearDisplay.textContent; // Format "YYYY年 M月"
                const parts = initialText.match(/(\d+)年\s*(\d+)月/);
                if (parts && parts.length === 3) {
                    currentCalendarYear = parseInt(parts[1], 10);
                    currentCalendarMonth = parseInt(parts[2], 10) - 1; // Adjust to 0-indexed
                } else {
                    // Fallback if parsing fails
                    const today = new Date();
                    currentCalendarYear = today.getFullYear();
                    currentCalendarMonth = today.getMonth();
                }
                updateCalendarDisplay(); // Ensure this is called after state is determined
            } else {
                // Fallback if element not found
                const today = new Date();
                currentCalendarYear = today.getFullYear();
                currentCalendarMonth = today.getMonth();
                // updateCalendarDisplay will be called if monthYearDisplay is found later or when app opens
            }
        }

        function renderCalendarGrid() {
            const daysBody = document.getElementById('calendar-days-body');
            if (!daysBody) return;
            daysBody.innerHTML = ''; // Clear previous grid

            // Calculate today's date considering the user's selected timezone for correct highlighting
            const nowGlobal = new Date();
            const todayLocalOffset = new Date(nowGlobal.getTime() + parseFloat(currentTimezone) * 3600 * 1000);
            const todayDate = todayLocalOffset.getUTCDate();
            const todayMonth = todayLocalOffset.getUTCMonth();
            const todayYear = todayLocalOffset.getUTCFullYear();

            const firstDayOfMonth = new Date(Date.UTC(currentCalendarYear, currentCalendarMonth, 1));
            const daysInMonth = new Date(Date.UTC(currentCalendarYear, currentCalendarMonth + 1, 0)).getUTCDate();
            const startingDayOfWeek = firstDayOfMonth.getUTCDay(); // 0 (Sun) - 6 (Sat)

            const daysInPrevMonth = new Date(Date.UTC(currentCalendarYear, currentCalendarMonth, 0)).getUTCDate();

            let dayCounter = 1;
            let nextMonthDayCounter = 1;
            const totalCells = 42; // 6 weeks * 7 days

            for (let i = 0; i < totalCells; i++) {
                const dayCell = document.createElement('div');
                dayCell.style.padding = '5px 0';
                dayCell.style.minHeight = '30px'; // Ensure cells have a minimum height
                dayCell.style.display = 'flex';
                dayCell.style.alignItems = 'center';
                dayCell.style.justifyContent = 'center';
                dayCell.style.boxSizing = 'border-box';


                if (i < startingDayOfWeek) { // Days from previous month
                    dayCell.textContent = daysInPrevMonth - startingDayOfWeek + 1 + i;
                    dayCell.style.color = document.body.classList.contains('dark-mode') ? '#777' : '#aaa';
                } else if (dayCounter <= daysInMonth) { // Days of current month
                    dayCell.textContent = dayCounter;
                    if (dayCounter === todayDate && currentCalendarMonth === todayMonth && currentCalendarYear === todayYear) {
                        dayCell.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim();
                        dayCell.style.color = 'white';
                        dayCell.style.borderRadius = '50%';
                        // Adjust width/height for better circle appearance if needed, considering padding
                        dayCell.style.width = '28px'; 
                        dayCell.style.height = '28px';
                        dayCell.style.margin = 'auto'; // Center the circle if cell is larger
                    } else {
                         // Color will be inherited from #calendar-app-content or body.dark-mode .window-content
                    }
                    dayCounter++;
                } else { // Days from next month
                    dayCell.textContent = nextMonthDayCounter;
                    dayCell.style.color = document.body.classList.contains('dark-mode') ? '#777' : '#aaa';
                    nextMonthDayCounter++;
                }
                daysBody.appendChild(dayCell);
            }
        }


        function updateCalendarDisplay() {
            if (monthYearDisplay) {
                monthYearDisplay.textContent = `${currentCalendarYear}年 ${currentCalendarMonth + 1}月`;
            }
            renderCalendarGrid();
        }

        if (prevMonthBtn) {
            prevMonthBtn.addEventListener('click', () => {
                currentCalendarMonth--;
                if (currentCalendarMonth < 0) {
                    currentCalendarMonth = 11; // December
                    currentCalendarYear--;
                }
                updateCalendarDisplay();
            });
        }

        if (nextMonthBtn) {
            nextMonthBtn.addEventListener('click', () => {
                currentCalendarMonth++;
                if (currentCalendarMonth > 11) {
                    currentCalendarMonth = 0; // January
                    currentCalendarYear++;
                }
                updateCalendarDisplay();
            });
        }

        // Initialize calendar state when the script loads or when the calendar app is opened.
        // A good place might be to call initializeCalendarState() before the calendar window is shown,
        // or ensure it's called once the DOM is fully loaded if these elements are always present.
        // For now, let's ensure it's callable and consider its invocation point.
        // We need to make sure this runs after the calendar DOM elements are available.
        // A simple way is to call it if the monthYearDisplay element exists,
        // which implies the calendar window elements are in the DOM.
        if (monthYearDisplay) {
            initializeCalendarState();
        }

        const appWindows = {
            'settings': document.getElementById('settings-window'),
            'chrome': document.getElementById('chrome-window'),
            'minecraft-bedrock': document.getElementById('minecraft-bedrock-window'),
            'minecraft-java': document.getElementById('minecraft-java-window'),
            'amazon': document.getElementById('amazon-window'),
            'click-game': document.getElementById('click-game-window'),
            'microsoft-store': document.getElementById('microsoft-store-window'),
            'roblox': document.getElementById('roblox-window'),
            'x': document.getElementById('x-window'),
            'youtube': document.getElementById('youtube-window'),
            'google-meet': document.getElementById('google-meet-window'),
            'google-drive': document.getElementById('google-drive-window'),
            'notepad': document.getElementById('notepad-window'),
            'calculator': document.getElementById('calculator-window'),
            // New Apps
            'bing': document.getElementById('bing-window'),
            'xbox': document.getElementById('xbox-window'),
            'teams': document.getElementById('teams-window'),
            'github': document.getElementById('github-window'),
            'google': document.getElementById('google-window'),
            'google-play': document.getElementById('google-play-window'),
            'calendar': document.getElementById('calendar-window'),
            'wikipedia': document.getElementById('wikipedia-window'),
        };
        
        const appInfo = {
             'calculator': { name: "電卓", icon: document.querySelector('.app-icon[data-app="calculator"] .icon').innerHTML },
             'chrome': { name: "Google Chrome", icon: document.querySelector('.app-icon[data-app="chrome"] .icon').innerHTML },
             'minecraft-bedrock': { name: "Minecraft Bedrock", icon: document.querySelector('.app-icon[data-app="minecraft-bedrock"] .icon').innerHTML },
             'minecraft-java': { name: "Minecraft Java", icon: document.querySelector('.app-icon[data-app="minecraft-java"] .icon').innerHTML },
             'amazon': { name: "Amazon", icon: document.querySelector('.app-icon[data-app="amazon"] .icon').innerHTML },
             'click-game': { name: "クリックゲーム", icon: document.querySelector('.app-icon[data-app="click-game"] .icon').innerHTML },
             'settings': { name: "設定", icon: document.querySelector('.app-icon[data-app="settings"] .icon').innerHTML },
             'microsoft-store': { name: "Microsoft Store", icon: document.querySelector('.app-icon[data-app="microsoft-store"] .icon').innerHTML },
             'notepad': { name: "メモ帳", icon: document.querySelector('.app-icon[data-app="notepad"] .icon').innerHTML },
             'roblox': { name: "Roblox", icon: document.querySelector('.app-icon[data-app="roblox"] .icon').innerHTML },
             'x': { name: "X", icon: document.querySelector('.app-icon[data-app="x"] .icon').innerHTML },
             'youtube': { name: "YouTube", icon: document.querySelector('.app-icon[data-app="youtube"] .icon').innerHTML },
             'google-meet': { name: "Google Meet", icon: document.querySelector('.app-icon[data-app="google-meet"] .icon').innerHTML },
             'google-drive': { name: "Google Drive", icon: document.querySelector('.app-icon[data-app="google-drive"] .icon').innerHTML },
             'bing': { name: "Bing", icon: document.querySelector('.app-icon[data-app="bing"] .icon').innerHTML },
             'xbox': { name: "Xbox", icon: '<svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" fill="currentColor" class="bi bi-xbox" viewBox="0 0 16 16"><path d="M7.202 15.967a8 8 0 0 1-3.552-1.26c-.898-.585-1.101-.826-1.101-1.306 0-.965 1.062-2.656 2.879-4.583C6.459 7.723 7.897 6.44 8.052 6.475c.302.068 2.718 2.423 3.622 3.531 1.43 1.753 2.088 3.189 1.754 3.829-.254.486-1.83 1.437-2.987 1.802-.954.301-2.207.429-3.239.33m-5.866-3.57C.589 11.253.212 10.127.03 8.497c-.06-.539-.038-.846.137-1.95.218-1.377 1.002-2.97 1.945-3.95.401-.417.437-.427.926-.263.595.2 1.23.638 2.213 1.528l.574.519-.313.385C4.056 6.553 2.52 9.086 1.94 10.653c-.315.852-.442 1.707-.306 2.063.091.24.007.15-.3-.319Zm13.101.195c.074-.36-.019-1.02-.238-1.687-.473-1.443-2.055-4.128-3.508-5.953l-.457-.575.494-.454c.646-.593 1.095-.948 1.58-1.25.381-.237.927-.448 1.161-.448.145 0 .654.528 1.065 1.104a8.4 8.4 0 0 1 1.343 3.102c.153.728.166 2.286.024 3.012a9.5 9.5 0 0 1-.6 1.893c-.179.393-.624 1.156-.82 1.404-.1.128-.1.127-.043-.148ZM7.335 1.952c-.67-.34-1.704-.705-2.276-.803a4 4 0 0 0-.759-.043c-.471.024-.45 0 .306-.358A7.8 7.8 0 0 1 6.47.128c.8-.169 2.306-.17 3.094-.005.85.18 1.853.552 2.418.9l.168.103-.385-.02c-.766-.038-1.88.27-3.078.853-.361.176-.676.316-.699.312a12 12 0 0 1-.654-.319Z"/></svg>' },
             'teams': { name: "Microsoft Teams", icon: document.querySelector('.app-icon[data-app="teams"] .icon').innerHTML },
             'github': { name: "GitHub", icon: document.querySelector('.app-icon[data-app="github"] .icon').innerHTML },
             'google': { name: "Google", icon: document.querySelector('.app-icon[data-app="google"] .icon').innerHTML },
             'google-play': { name: "Google Play", icon: document.querySelector('.app-icon[data-app="google-play"] .icon').innerHTML },
             'calendar': { name: "カレンダー", icon: document.querySelector('.app-icon[data-app="calendar"] .icon').innerHTML },
             'wikipedia': { name: "Wikipedia", icon: document.querySelector('.app-icon[data-app="wikipedia"] .icon').innerHTML },
        };

        // Click Game variables
        let clickCount = 0;
        const clickButtonEl = document.getElementById('click-button');
        const clickCountDisplay = document.getElementById('click-count');

        if (clickButtonEl) {
            clickButtonEl.addEventListener('click', () => {
                clickCount++;
                if (clickCountDisplay) clickCountDisplay.textContent = clickCount;
            });
        }

        // Calculator variables
        const calculatorDisplay = document.getElementById('calculator-display');
        const calculatorButtons = document.querySelectorAll('.calculator-button');
        let calcCurrentInput = '0';
        let calcPreviousInput = '';
        let calcOperator = null;
        let shouldResetDisplay = false;


        // --- Animation Helper Functions ---
        function showAnimatedElement(element, displayType = 'flex', transformX = '-50%', onShown) {
            if (!element) return;
            if (element === startMenu) {
                hideAnimatedElement(searchBar, '-50%');
                hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            } else if (element === searchBar) {
                hideAnimatedElement(startMenu, '-50%');
                hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            }
            hideTaskbarPopups();

            element.style.display = displayType;
            void element.offsetWidth;
            requestAnimationFrame(() => {
                element.style.opacity = '1';
                if (element.id === 'start-menu' || element.id === 'search-bar') {
                    element.style.transform = `translateX(${transformX}) scale(1) translateY(0px)`;
                } else if (element.id === 'power-options-popup') {
                     const currentX = window.getComputedStyle(element).getPropertyValue('transform').includes('translateX') ?
                                   window.getComputedStyle(element).getPropertyValue('transform').match(/translateX\(([^)]+)\)/)[1] :
                                   (window.innerWidth <= 768 ? '0px' : 'calc(-50% + 200px)');
                    element.style.transform = `translateX(${currentX}) scale(1) translateY(0px)`;
                } else {
                    const currentOffsetX = parseFloat(element.dataset.offsetX || "0");
                    const currentOffsetY = parseFloat(element.dataset.offsetY || "0");
                    element.style.transform = `translate(-50%, -50%) translate3d(${currentOffsetX}px, ${currentOffsetY}px, 0) scale(1)`;
                }
                if (onShown) onShown();
            });
        }

        function hideAnimatedElement(element, transformX = '-50%', onHidden) {
            if (element && element.style.display !== 'none') {
                element.style.opacity = '0';
                 if (element.id === 'start-menu' || element.id === 'search-bar') {
                    element.style.transform = `translateX(${transformX}) scale(0.95) translateY(20px)`;
                } else if (element.id === 'power-options-popup') {
                     const currentX = window.getComputedStyle(element).getPropertyValue('transform').includes('translateX') ?
                                   window.getComputedStyle(element).getPropertyValue('transform').match(/translateX\(([^)]+)\)/)[1] :
                                   (window.innerWidth <= 768 ? '0px' : 'calc(-50% + 200px)');
                    element.style.transform = `translateX(${currentX}) scale(0.95) translateY(10px)`;
                } else {
                    const currentOffsetX = parseFloat(element.dataset.offsetX || "0");
                    const currentOffsetY = parseFloat(element.dataset.offsetY || "0");
                    element.style.transform = `translate(-50%, -50%) translate3d(${currentOffsetX}px, ${currentOffsetY}px, 0) scale(0.95) translateY(20px)`;
                }
                setTimeout(() => {
                    element.style.display = 'none';
                    if (onHidden) onHidden();
                }, 250);
            } else if (onHidden) {
                onHidden();
            }
        }


        // --- Initial Load and State Check ---
        window.onload = () => {
            applyTheme();

            // Minecraft Bedrock App Specific Initialisation
            const mcBedrockContent = document.getElementById('mc-bedrock-content');
            if (mcBedrockContent) {
                const mcBedrockMainMenu = mcBedrockContent.querySelector('#mc-bedrock-main-menu');
                const mcBedrockDynamicContent = mcBedrockContent.querySelector('#mc-bedrock-dynamic-content');

                function showBedrockMessage(message) {
                    if (mcBedrockMainMenu) mcBedrockMainMenu.style.display = 'none';
                    if (mcBedrockDynamicContent) {
                        mcBedrockDynamicContent.innerHTML = `<p style="color: white;">${message}</p><button id="mc-bedrock-back" class="mc-button">戻る</button>`; // Ensure text is white
                        mcBedrockDynamicContent.style.display = 'block';
                        const backButton = mcBedrockDynamicContent.querySelector('#mc-bedrock-back');
                        if (backButton) {
                            backButton.onclick = () => {
                                mcBedrockDynamicContent.style.display = 'none';
                                if (mcBedrockMainMenu) mcBedrockMainMenu.style.display = 'flex';
                            };
                        }
                    }
                }

                function showBedrockWorldSelect() {
                    if (mcBedrockMainMenu) mcBedrockMainMenu.style.display = 'none';
                    if (mcBedrockDynamicContent) {
                        mcBedrockDynamicContent.innerHTML = `<h2 style="color: white;">ワールド選択</h2><p style="color: white;">ワールドを選択してください... (シュミレーション)</p><div style="height: 100px; background: #333; margin-bottom:10px; display:flex; align-items:center; justify-content:center; color: white;">仮のワールドリスト</div><button id="mc-bedrock-back-ws" class="mc-button">戻る</button>`; // Ensure text is white
                        mcBedrockDynamicContent.style.display = 'block';
                        const backButton = mcBedrockDynamicContent.querySelector('#mc-bedrock-back-ws');
                        if (backButton) {
                            backButton.onclick = () => {
                                mcBedrockDynamicContent.style.display = 'none';
                                if (mcBedrockMainMenu) mcBedrockMainMenu.style.display = 'flex'; 
                            };
                        }
                    }
                }
                
                // Ensure main menu style for flex children, if not already set by HTML.
                // The HTML already has display: flex; flex-direction: column; align-items: center; justify-content: center;
                // So this line might be redundant but ensures the state if HTML was different.
                // if(mcBedrockMainMenu) mcBedrockMainMenu.style.flexDirection = 'column'; 


                const mcBedrockSingleplayer = mcBedrockContent.querySelector('#mc-bedrock-singleplayer');
                if (mcBedrockSingleplayer) mcBedrockSingleplayer.onclick = showBedrockWorldSelect;

                const mcBedrockMultiplayer = mcBedrockContent.querySelector('#mc-bedrock-multiplayer');
                if (mcBedrockMultiplayer) mcBedrockMultiplayer.onclick = () => showBedrockMessage("マルチプレイは現在使用できません(シュミレーション)");

                const mcBedrockMarketplace = mcBedrockContent.querySelector('#mc-bedrock-marketplace');
                if (mcBedrockMarketplace) mcBedrockMarketplace.onclick = () => showBedrockMessage("マーケットプレイスは現在使用できません(シュミレーション)");
                
                const mcBedrockRealms = mcBedrockContent.querySelector('#mc-bedrock-realms');
                if (mcBedrockRealms) mcBedrockRealms.onclick = () => showBedrockMessage("Realmsは現在使用できません(シュミレーション)");

                const mcBedrockSkins = mcBedrockContent.querySelector('#mc-bedrock-skins');
                if (mcBedrockSkins) mcBedrockSkins.onclick = () => showBedrockMessage("スキンは現在使用できません(シュミレーション)");

                const mcBedrockSettingsBtn = mcBedrockContent.querySelector('#mc-bedrock-settings');
                if (mcBedrockSettingsBtn) mcBedrockSettingsBtn.onclick = () => showBedrockMessage("設定は現在使用できません(シュミレーション)");
            }
            // End of Minecraft Bedrock App Specific Initialisation

            // Minecraft Java App Specific Initialisation
            const mcJavaContent = document.getElementById('mc-java-content');
            if (mcJavaContent) {
                const mcJavaMainMenu = mcJavaContent.querySelector('#mc-java-main-menu');
                const mcJavaDynamicContent = mcJavaContent.querySelector('#mc-java-dynamic-content');

                function showJavaMessage(message) {
                    if (mcJavaMainMenu) mcJavaMainMenu.style.display = 'none';
                    if (mcJavaDynamicContent) {
                        mcJavaDynamicContent.innerHTML = `<p style="color: white;">${message}</p><button id="mc-java-back" class="mc-button">戻る</button>`;
                        mcJavaDynamicContent.style.display = 'block';
                        const backButton = mcJavaDynamicContent.querySelector('#mc-java-back');
                        if (backButton) {
                            backButton.onclick = () => {
                                mcJavaDynamicContent.style.display = 'none';
                                if (mcJavaMainMenu) mcJavaMainMenu.style.display = 'flex';
                            };
                        }
                    }
                }

                function showJavaWorldSelect() {
                    if (mcJavaMainMenu) mcJavaMainMenu.style.display = 'none';
                    if (mcJavaDynamicContent) {
                        mcJavaDynamicContent.innerHTML = `<h2 style="color: white;">Select World</h2><p style="color: white;">Please select a world... (Simulation)</p><div style="height: 100px; background: #333; margin-bottom:10px; display:flex; align-items:center; justify-content:center; color:white;">Placeholder World List</div><button id="mc-java-back-ws" class="mc-button">Back</button>`;
                        mcJavaDynamicContent.style.display = 'block';
                        const backButton = mcJavaDynamicContent.querySelector('#mc-java-back-ws');
                        if (backButton) {
                            backButton.onclick = () => {
                                mcJavaDynamicContent.style.display = 'none';
                                if (mcJavaMainMenu) mcJavaMainMenu.style.display = 'flex';
                            };
                        }
                    }
                }

                const mcJavaSingleplayer = mcJavaContent.querySelector('#mc-java-singleplayer');
                if (mcJavaSingleplayer) mcJavaSingleplayer.onclick = showJavaWorldSelect;

                const mcJavaMultiplayer = mcJavaContent.querySelector('#mc-java-multiplayer');
                if (mcJavaMultiplayer) mcJavaMultiplayer.onclick = () => showJavaMessage("マルチプレイは現在使用できません(シュミレーション)");

                const mcJavaRealms = mcJavaContent.querySelector('#mc-java-realms');
                if (mcJavaRealms) mcJavaRealms.onclick = () => showJavaMessage("Realmsは現在使用できません(シュミレーション)");
                
                const mcJavaSkins = mcJavaContent.querySelector('#mc-java-skins');
                if (mcJavaSkins) mcJavaSkins.onclick = () => showJavaMessage("スキンは現在使用できません(シュミレーション)");

                const mcJavaSettingsBtn = mcJavaContent.querySelector('#mc-java-settings');
                if (mcJavaSettingsBtn) mcJavaSettingsBtn.onclick = () => showJavaMessage("設定は現在使用できません(シュミレーション)");

                const mcJavaInstallationsBtn = mcJavaContent.querySelector('#mc-java-installations');
                if (mcJavaInstallationsBtn) mcJavaInstallationsBtn.onclick = () => showJavaMessage("Installations are not configurable in this simulation.");
            }
            // End of Minecraft Java App Specific Initialisation

            if (!isSetupComplete) {
                showSetupScreen();
            } else {
                showPasswordScreen();
            }
            updateDateTime();
            setInterval(updateDateTime, 1000);
            updateBatteryStatus();
            initializeWindowControls();
            initializeCalculator(); // Initialize calculator buttons

            [startMenu, searchBar, powerOptionsPopup, ...Object.values(appWindows)].forEach(el => {
                if(el) {
                    el.style.opacity = '0';
                    if (el.id === 'start-menu' || el.id === 'search-bar') {
                        el.style.transform = `translateX(-50%) scale(0.95) translateY(20px)`;
                    } else if (el.id === 'power-options-popup') {
                        const initialX = window.innerWidth <= 768 ? '0px' : 'calc(-50% + 200px)';
                         if(window.innerWidth <= 768 && el.style.left === "50%") {
                            el.style.transform = `translateX(-50%) scale(0.95) translateY(10px)`;
                        } else {
                            el.style.transform = `translateX(${initialX}) scale(0.95) translateY(10px)`;
                        }
                    } else {
                         el.style.transform = `translate(-50%, -50%) scale(0.95) translateY(20px)`;
                    }
                }
            });
        };

        // --- Theme Handling ---
        function applyTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            updateCursorStyle();
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);

        // --- Custom Cursor ---
        document.addEventListener('mousemove', (e) => {
            customCursor.style.left = e.clientX + 'px';
            customCursor.style.top = e.clientY + 'px';
        });
         document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 0) {
                customCursor.style.left = e.touches[0].clientX + 'px';
                customCursor.style.top = e.touches[0].clientY + 'px';
            }
        }, { passive: true });


        function updateCursorStyle() {
            const fillColor = document.body.classList.contains('dark-mode') ? '%23fff' : '%23000';
            if (currentMouseIcon === 'pointer') {
                 customCursor.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="${fillColor}" d="M3.31 14.61l-1.53 1.54c-.5.5-.12 1.36.59 1.55l4.1.97l.97 4.1c.19.71 1.05 1.09 1.55.59l1.54-1.53l4.95 4.95c.39.39 1.02.39 1.41 0l2.3-2.3c.39-.39.39-1.02 0-1.41l-4.95-4.95l1.53-1.54c.5-.5.12-1.36-.59-1.55l-4.1-.97l-.97-4.1c-.19-.71-1.05-1.09-1.55-.59l-1.54 1.53l-4.95-4.95c-.39-.39-1.02-.39-1.41 0l-2.3 2.3c-.39.38-.39 1.02 0 1.41l4.95 4.95z"/></svg>')`;
            } else {
                 customCursor.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill="${fillColor}" d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103zM2.25 8.184l3.897 1.67a.5.5 0 0 1 .262.263l1.67 3.897L12.743 3.52z"/></svg>')`;
            }
        }

        // --- Screen Switching & Setup/Password Logic ---
        function showSetupScreen() {
            setupScreen.style.display = 'flex'; passwordScreen.style.display = 'none'; desktopScreen.style.display = 'none';
            populateTimezoneSelect('setup-timezone');
            const setupTimezone = document.getElementById('setup-timezone');
            if(setupTimezone) setupTimezone.value = currentTimezone;
            setupLanguage.value = currentLanguage; setupRegion.value = currentRegion; /* setupDate and setupTime removed */ setupKeyboard.value = currentKeyboard; setupMouseIcon.value = currentMouseIcon; setupWallpaper.value = currentWallpaper; setupUsernameInput.value = currentUsername; setupPcNameInput.value = currentPcName; setupPasswordInput.value = storedPassword;
        }
        function showPasswordScreen() {
            setupScreen.style.display = 'none'; passwordScreen.style.display = 'flex'; desktopScreen.style.display = 'none';
            loginPasswordInput.value = ''; passwordError.style.visibility = 'hidden';
            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            Object.values(appWindows).forEach(win => hideAnimatedElement(win));
            hideTaskbarPopups();
        }
        function showDesktopScreen() {
            setupScreen.style.display = 'none'; passwordScreen.style.display = 'none'; desktopScreen.style.display = 'flex';
            applySettingsToDesktop();
        }
        completeSetupButton.addEventListener('click', () => {
            currentLanguage = setupLanguage.value;
            currentRegion = setupRegion.value;
            currentKeyboard = setupKeyboard.value;
            currentMouseIcon = setupMouseIcon.value; // Corrected from setupMouseIcon.value to currentMouseIcon
            currentWallpaper = setupWallpaper.value; // Corrected from setupWallpaper.value to currentWallpaper
            currentUsername = setupUsernameInput.value || 'ユーザー';
            currentPcName = setupPcNameInput.value || 'MY-PC';
            storedPassword = setupPasswordInput.value;
            currentTimezone = document.getElementById('setup-timezone').value;

            Object.entries({
                setupComplete: 'true',
                password: storedPassword,
                username: currentUsername,
                pcName: currentPcName,
                language: currentLanguage,
                region: currentRegion,
                keyboard: currentKeyboard,
                mouseIcon: currentMouseIcon,
                wallpaper: currentWallpaper,
                timezone: currentTimezone
            }).forEach(([key, value]) => localStorage.setItem(key, value));
            isSetupComplete = true; showPasswordScreen();
        });
        loginButton.addEventListener('click', () => {
            if (loginPasswordInput.value === storedPassword) { showDesktopScreen(); } else { passwordError.style.visibility = 'visible'; }
        });
        loginPasswordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') loginButton.click(); });

        function applySettingsToDesktop() {
            if (currentWallpaper === 'default') { desktopScreen.style.backgroundImage = 'url("https://placehold.co/1920x1080/0078d4/fff?text=Windows+11")'; }
            else if (currentWallpaper === 'abstract') { desktopScreen.style.backgroundImage = 'url("https://placehold.co/1920x1080/ff6347/fff?text=Abstract+Wallpaper")';}
            startMenuUsername.textContent = currentUsername;
            startMenuUserAvatar.alt = currentUsername + " Avatar";
            updateCursorStyle(); updateDateTime();
        }

        // --- Taskbar & Popups Logic ---
        startButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (startMenu.style.display === 'flex') {
                hideAnimatedElement(startMenu, '-50%');
                hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            } else {
                hideAnimatedElement(searchBar, '-50%');
                hideTaskbarPopups();
                showAnimatedElement(startMenu, 'flex', '-50%');
            }
        });

        searchButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (searchBar.style.display === 'flex') {
                hideAnimatedElement(searchBar, '-50%', () => {
                    searchInput.value = '';
                    searchResults.innerHTML = '<p>ここに検索結果が表示されます。</p>';
                });
            } else {
                hideAnimatedElement(startMenu, '-50%');
                hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
                hideTaskbarPopups();
                showAnimatedElement(searchBar, 'flex', '-50%', () => searchInput.focus());
            }
        });

        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            searchResults.innerHTML = '';
            if (query) {
                const appNames = Object.keys(appInfo).reduce((acc, key) => {
                    acc[key] = appInfo[key].name;
                    return acc;
                }, {});

                let found = false;
                for (const appId in appNames) { if (appNames[appId].toLowerCase().includes(query) || appId.includes(query)) { searchResults.innerHTML += `<div data-app="${appId}">${appNames[appId]} アプリ</div>`; found = true;}}
                if ('ファイル'.includes(query) || 'file'.includes(query)) { searchResults.innerHTML += '<div>ファイル エクスプローラー (ダミー)</div>'; found = true; }
                if ('ウェブ'.includes(query) || 'web'.includes(query)) { searchResults.innerHTML += '<div>ウェブを検索 (ダミー)</div>'; found = true; }
                if (!found) { searchResults.innerHTML = `<p>「${searchInput.value}」に一致する結果は見つかりませんでした。`}
                else { searchResults.querySelectorAll('div[data-app]').forEach(res => res.addEventListener('click', () => { hideAnimatedElement(searchBar, '-50%'); openAppWindow(res.dataset.app); }));}
            } else { searchResults.innerHTML = '<p>ここに検索結果が表示されます。</p>'; }
        });

        desktopScreen.addEventListener('click', (e) => {
            let clickedInsideInteractiveElement = false;
            [startMenu, searchBar, datetimePopup, batteryPopup, wifiPopup, powerOptionsPopup, ...Object.values(appWindows)].forEach(el => {
                if (el && el.style.display !== 'none' && el.contains(e.target)) {
                    clickedInsideInteractiveElement = true;
                }
            });
            if (startButton.contains(e.target) || searchButton.contains(e.target) ||
                timeDisplay.parentElement.contains(e.target) || batteryStatusItem.contains(e.target) ||
                wifiStatusItem.contains(e.target) ||
                startMenuPowerButton.contains(e.target)) {
                clickedInsideInteractiveElement = true;
            }

            if (!clickedInsideInteractiveElement) {
                hideAnimatedElement(startMenu, '-50%');
                hideAnimatedElement(searchBar, '-50%', () => {
                    searchInput.value = '';
                    searchResults.innerHTML = '<p>ここに検索結果が表示されます。</p>';
                });
                hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
                hideTaskbarPopups();
            }
        });

        [startMenu, searchBar, datetimePopup, batteryPopup, wifiPopup, powerOptionsPopup, ...Object.values(appWindows)].forEach(el => {
            if (el) el.addEventListener('click', (e) => e.stopPropagation());
        });

        function hideTaskbarPopups() {
            if (datetimePopup.style.display !== 'none') datetimePopup.style.display = 'none';
            if (batteryPopup.style.display !== 'none') batteryPopup.style.display = 'none';
            if (wifiPopup.style.display !== 'none') wifiPopup.style.display = 'none';
        }

        function updateDateTime() {
            const now = new Date();
            const selectedTimezoneOffsetHours = parseFloat(currentTimezone);
            const displayTimeForZone = new Date(now.getTime() + selectedTimezoneOffsetHours * 3600 * 1000);

            currentDate = `${displayTimeForZone.getUTCFullYear()}-${String(displayTimeForZone.getUTCMonth() + 1).padStart(2, '0')}-${String(displayTimeForZone.getUTCDate()).padStart(2, '0')}`;
            currentTime = `${String(displayTimeForZone.getUTCHours()).padStart(2, '0')}:${String(displayTimeForZone.getUTCMinutes()).padStart(2, '0')}`;

            timeDisplay.textContent = displayTimeForZone.toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit', timeZone: 'UTC' });
            dateDisplay.textContent = displayTimeForZone.toLocaleDateString(currentLanguage, { year: 'numeric', month: 'numeric', day: 'numeric', timeZone: 'UTC' });

            popupDatetime.textContent = `${displayTimeForZone.toLocaleDateString(currentLanguage, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })} ${displayTimeForZone.toLocaleTimeString(currentLanguage, {hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'UTC'})}`;
            popupRegion.textContent = currentRegion;
            popupLanguage.textContent = currentLanguage;
        }

        function populateTimezoneSelect(selectElementId) {
            const selectElement = document.getElementById(selectElementId);
            if (!selectElement) return;
            selectElement.innerHTML = ''; 
            const timezones = [
                { value: '-12', label: 'UTC-12:00 (国際日付変更線 西側)' },
                { value: '-11', label: 'UTC-11:00 (ミッドウェー島)' },
                { value: '-10', label: 'UTC-10:00 (ハワイ)' },
                { value: '-9.5', label: 'UTC-09:30 (マルキーズ諸島)' },
                { value: '-9', label: 'UTC-09:00 (アラスカ)' },
                { value: '-8', label: 'UTC-08:00 (太平洋標準時 - バンクーバー、ティフアナ)' },
                { value: '-7', label: 'UTC-07:00 (山岳部標準時 - デンバー、フェニックス)' },
                { value: '-6', label: 'UTC-06:00 (中部標準時 - シカゴ、メキシコシティ)' },
                { value: '-5', label: 'UTC-05:00 (東部標準時 - ニューヨーク、リマ)' },
                { value: '-4', label: 'UTC-04:00 (大西洋標準時 - ハリファックス、カラカス)' },
                { value: '-3.5', label: 'UTC-03:30 (ニューファンドランド)' },
                { value: '-3', label: 'UTC-03:00 (ブラジリア、ブエノスアイレス)' },
                { value: '-2', label: 'UTC-02:00 (中央大西洋)' },
                { value: '-1', label: 'UTC-01:00 (アゾレス諸島、カーボベルデ)' },
                { value: '0', label: 'UTC±00:00 (グリニッジ標準時 - ロンドン、ダブリン)' },
                { value: '1', label: 'UTC+01:00 (中央ヨーロッパ標準時 - パリ、ベルリン)' },
                { value: '2', label: 'UTC+02:00 (東ヨーロッパ標準時 - アテネ、カイロ)' },
                { value: '3', label: 'UTC+03:00 (モスクワ標準時、東アフリカ時間)' },
                { value: '3.5', label: 'UTC+03:30 (イラン標準時)' },
                { value: '4', label: 'UTC+04:00 (湾岸標準時 - ドバイ)' },
                { value: '4.5', label: 'UTC+04:30 (アフガニスタン)' },
                { value: '5', label: 'UTC+05:00 (パキスタン標準時)' },
                { value: '5.5', label: 'UTC+05:30 (インド標準時)' },
                { value: '5.75', label: 'UTC+05:45 (ネパール時間)' },
                { value: '6', label: 'UTC+06:00 (バングラデシュ標準時)' },
                { value: '6.5', label: 'UTC+06:30 (ミャンマー)' },
                { value: '7', label: 'UTC+07:00 (インドシナ時間 - バンコク、ジャカルタ)' },
                { value: '8', label: 'UTC+08:00 (中国標準時 - 北京、パース)' },
                { value: '8.75', label: 'UTC+08:45 (オーストラリア中西部標準時)' },
                { value: '9', label: 'UTC+09:00 (日本標準時、韓国標準時)' },
                { value: '9.5', label: 'UTC+09:30 (オーストラリア中部標準時 - アデレード)' },
                { value: '10', label: 'UTC+10:00 (オーストラリア東部標準時 - シドニー)' },
                { value: '10.5', label: 'UTC+10:30 (ロード・ハウ島)' },
                { value: '11', label: 'UTC+11:00 (ソロモン諸島、バヌアツ)' },
                { value: '12', label: 'UTC+12:00 (ニュージーランド標準時)' },
                { value: '12.75', label: 'UTC+12:45 (チャタム諸島)' },
                { value: '13', label: 'UTC+13:00 (サモア時間帯、トンガ)' },
                { value: '14', label: 'UTC+14:00 (キリバス)' }
            ];
            timezones.forEach(tz => {
                const option = document.createElement('option');
                option.value = tz.value;
                option.textContent = tz.label;
                selectElement.appendChild(option);
            });
        }
        function updateBatteryStatus() {
             batteryLevelDisplay.textContent = `100%`;
             popupBatteryLevel.textContent = `100%`;
             popupBatteryStatus.textContent = '電源に接続: 充電中';
        }
        timeDisplay.parentElement.addEventListener('click', (e) => {
            e.stopPropagation();
            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            if (datetimePopup.style.display === 'flex') {
                datetimePopup.style.display = 'none';
            } else {
                hideTaskbarPopups();
                datetimePopup.style.display = 'flex';
                update// (前回のコードの続き)

                updateDateTime();
            }
        });

        batteryStatusItem.addEventListener('click', (e) => {
            e.stopPropagation();
            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            if (batteryPopup.style.display === 'flex') {
                batteryPopup.style.display = 'none';
            } else {
                hideTaskbarPopups();
                batteryPopup.style.display = 'flex';
                updateBatteryStatus();
            }
        });

        wifiStatusItem.addEventListener('click', (e) => {
            e.stopPropagation();
            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            if (wifiPopup.style.display === 'flex') {
                wifiPopup.style.display = 'none';
            } else {
                hideTaskbarPopups();
                wifiPopup.style.display = 'flex';
            }
        });

        // --- Power Options Logic ---
        startMenuPowerButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (powerOptionsPopup.style.display === 'flex') {
                hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            } else {
                showAnimatedElement(powerOptionsPopup, 'flex', 'calc(-50% + 200px)');
            }
        });

        function performShutdown() {
            shutdownMessageText.textContent = "シャットダウンしています...";
            shutdownMessageSubtext.textContent = "PC の電源を切らないでください。";
            shutdownOverlay.style.display = 'flex';
            requestAnimationFrame(() => { shutdownOverlay.style.opacity = '1'; });

            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            Object.values(appWindows).forEach(win => hideAnimatedElement(win));
            hideTaskbarPopups();
            desktopScreen.style.opacity = 0;

            setTimeout(() => {
                shutdownOverlay.style.opacity = '0';
                setTimeout(() => {
                    shutdownOverlay.style.display = 'none';
                    desktopScreen.style.opacity = 1;
                    if (isSetupComplete) {
                        showPasswordScreen();
                    } else {
                        showSetupScreen();
                    }
                }, 300);
            }, 3000);
        }

        function performRestart() {
            shutdownMessageText.textContent = "再起動しています...";
            shutdownMessageSubtext.textContent = "";
            shutdownOverlay.style.display = 'flex';
            requestAnimationFrame(() => { shutdownOverlay.style.opacity = '1'; });

            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            Object.values(appWindows).forEach(win => hideAnimatedElement(win));
            hideTaskbarPopups();
            desktopScreen.style.opacity = 0;

            setTimeout(() => {
                shutdownOverlay.style.opacity = '0';
                setTimeout(() => {
                    shutdownOverlay.style.display = 'none';
                    desktopScreen.style.opacity = 1;
                    showPasswordScreen();
                }, 2500); // Shorter restart time
            }, 2000); // Shorter restart time
        }

        shutdownButton.addEventListener('click', (e) => {
            e.stopPropagation();
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)', performShutdown);
        });

        restartButton.addEventListener('click', (e) => {
            e.stopPropagation();
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)', performRestart);
        });


        // --- App, Window, and Taskbar Management ---
        appIcons.forEach(icon => icon.addEventListener('click', () => {
            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            hideTaskbarPopups();
            openAppWindow(icon.dataset.app);
        }));

        taskbarSettingsIcon.addEventListener('click', () => {
            hideAnimatedElement(startMenu, '-50%');
            hideAnimatedElement(searchBar, '-50%');
            hideAnimatedElement(powerOptionsPopup, 'calc(-50% + 200px)');
            hideTaskbarPopups();
            openAppWindow('settings');
        });

        function openAppWindow(appId) {
            const windowElement = appWindows[appId];
            if (!windowElement) {
                console.warn(`${appId} window not found.`);
                return;
            }

            // Taskbar icon management
            let taskbarIcon = taskbarLeft.querySelector(`.taskbar-app-icon[data-app="${appId}"]`);
            if (!taskbarIcon) {
                taskbarIcon = document.createElement('div');
                taskbarIcon.className = 'taskbar-app-icon';
                taskbarIcon.dataset.app = appId;
                taskbarIcon.title = appInfo[appId].name;
                taskbarIcon.innerHTML = appInfo[appId].icon;
                taskbarLeft.appendChild(taskbarIcon);
            }
            
            // Show and activate window
            if (windowElement.style.display === 'none') {
                 showAnimatedElement(windowElement);
            }
            bringWindowToFront(windowElement);

            const windowTitleElement = windowElement.querySelector('.window-title');
            if (windowTitleElement && appInfo[appId] && appInfo[appId].icon) {
                let headerIcon = windowTitleElement.querySelector('.header-app-icon');
                if (!headerIcon) {
                    headerIcon = document.createElement('span');
                    headerIcon.className = 'header-app-icon';
                    headerIcon.innerHTML = appInfo[appId].icon;
                    const svgIcon = headerIcon.querySelector('svg');
                    if (svgIcon) {
                        svgIcon.style.width = '16px';
                        svgIcon.style.height = '16px';
                        svgIcon.style.marginRight = '8px';
                        svgIcon.style.verticalAlign = 'middle'; 
                    }
                    windowTitleElement.prepend(headerIcon);
                }
            }
            
            // Reset specific apps on open
            if (appId === 'settings') {
                populateTimezoneSelect('settings-timezone');
                const settingsTimezone = document.getElementById('settings-timezone');
                if(settingsTimezone) settingsTimezone.value = currentTimezone;
                // settingsDate.value and settingsTime.value removed
                settingsLanguage.value = currentLanguage; settingsRegion.value = currentRegion; settingsKeyboard.value = currentKeyboard; settingsMouseIcon.value = currentMouseIcon; settingsWallpaper.value = currentWallpaper; settingsUsernameInput.value = currentUsername; settingsPcNameInput.value = currentPcName; settingsPasswordInput.value = storedPassword; // Keep password for potential change

                if(settingsTimezone && !settingsTimezone.dataset.listenerAttached) { // Prevent multiple listeners
                    settingsTimezone.addEventListener('change', () => {
                        currentTimezone = settingsTimezone.value;
                        localStorage.setItem('timezone', currentTimezone);
                        updateDateTime();
                    });
                    settingsTimezone.dataset.listenerAttached = 'true'; // Mark as attached
                }
            }
             if (appId === 'click-game') {
                clickCount = 0;
                if(clickCountDisplay) clickCountDisplay.textContent = clickCount;
            }
            if (appId === 'calculator') {
                resetCalculator();
            }
            if (appId === 'calendar') {
                // Initialize or re-initialize calendar state every time it's opened
                // This ensures it reflects the current date/month if not already set
                // or if the user reopens it after some time.
                if (!currentCalendarYear || !currentCalendarMonth) { // If never initialized
                    const today = new Date();
                    const todayLocalOffset = new Date(today.getTime() + parseFloat(currentTimezone) * 3600 * 1000);
                    currentCalendarYear = todayLocalOffset.getUTCFullYear();
                    currentCalendarMonth = todayLocalOffset.getUTCMonth();
                }
                 initializeCalendarState(); // This will also call updateCalendarDisplay -> renderCalendarGrid
            }
            if (appId === 'minecraft-bedrock') {
                const bedrockMainMenu = document.querySelector('#mc-bedrock-window #mc-bedrock-main-menu');
                const bedrockDynamicContent = document.querySelector('#mc-bedrock-window #mc-bedrock-dynamic-content');
                if (bedrockMainMenu) bedrockMainMenu.style.display = 'flex'; // Ensure main menu is visible
                if (bedrockDynamicContent) bedrockDynamicContent.style.display = 'none'; // Ensure dynamic content is hidden
            }
            if (appId === 'minecraft-java') {
                const javaMainMenu = document.querySelector('#mc-java-window #mc-java-main-menu');
                const javaDynamicContent = document.querySelector('#mc-java-window #mc-java-dynamic-content');
                if (javaMainMenu) javaMainMenu.style.display = 'flex'; 
                if (javaDynamicContent) javaDynamicContent.style.display = 'none';
            }
        }
        
        function updateTaskbarActiveState(activeAppId) {
            document.querySelectorAll('.taskbar-app-icon').forEach(icon => {
                icon.classList.toggle('active', icon.dataset.app === activeAppId);
            });
        }
        
        taskbarLeft.addEventListener('click', (e) => {
            const taskbarIcon = e.target.closest('.taskbar-app-icon');
            if (taskbarIcon) {
                const appId = taskbarIcon.dataset.app;
                const windowElement = appWindows[appId];
                if (windowElement) {
                    const now = Date.now();
                    const appState = taskbarClickState[appId] || { lastClickTime: 0, wasHiddenByFirstClick: false };

                    if (now - appState.lastClickTime < 400) { // Double-click
                        if (appState.wasHiddenByFirstClick) {
                            // Reset window position and show
                            windowElement.style.top = '50%';
                            windowElement.style.left = '50%';
                            windowElement.dataset.offsetX = "0";
                            windowElement.dataset.offsetY = "0";
                            // Ensure the transform is reset for the animation by showAnimatedElement
                            showAnimatedElement(windowElement);
                            bringWindowToFront(windowElement);
                            appState.wasHiddenByFirstClick = false;
                        } else {
                            // Standard behavior for quick focus or if already visible
                            showAnimatedElement(windowElement); // Ensures it's visible if somehow hidden without the flag
                            bringWindowToFront(windowElement);
                            appState.wasHiddenByFirstClick = false; // Reset flag
                        }
                    } else { // Single-click or first click of a potential double-click
                        if (windowElement.style.display === 'none') {
                            showAnimatedElement(windowElement);
                            bringWindowToFront(windowElement);
                            appState.wasHiddenByFirstClick = false;
                        } else {
                            if (!taskbarIcon.classList.contains('active')) { // Window is visible but not active
                                bringWindowToFront(windowElement);
                                appState.wasHiddenByFirstClick = false;
                            } else { // Window is visible and active, so hide it
                                hideAnimatedElement(windowElement);
                                // taskbarIcon.classList.remove('active'); // Active state is managed by bringWindowToFront
                                appState.wasHiddenByFirstClick = true;
                            }
                        }
                    }
                    appState.lastClickTime = now;
                    taskbarClickState[appId] = appState;
                }
            }
        });

        function initializeWindowControls() {
            document.querySelectorAll('.window').forEach(windowElement => {
                const appId = windowElement.id.replace('-window', '');
                const header = windowElement.querySelector('.window-header');
                let isDragging = false, dragStartMouseX, dragStartMouseY;
                windowElement.dataset.offsetX = "0";
                windowElement.dataset.offsetY = "0";

                if (header) {
                    const onDragStart = (e, clientX, clientY) => {
                        if (e.target.closest('.window-buttons')) return;
                        isDragging = true; bringWindowToFront(windowElement);
                        dragStartMouseX = clientX; dragStartMouseY = clientY;
                        header.style.cursor = 'grabbing';
                    };
                    const onDragMove = (clientX, clientY) => {
                        if (!isDragging) return;
                        const currentOffsetX = parseFloat(windowElement.dataset.offsetX);
                        const currentOffsetY = parseFloat(windowElement.dataset.offsetY);
                        const dx = clientX - dragStartMouseX; const dy = clientY - dragStartMouseY;
                        windowElement.style.transform = `translate(-50%, -50%) translate3d(${currentOffsetX + dx}px, ${currentOffsetY + dy}px, 0) scale(1)`;
                    };
                    const onDragEnd = (clientX, clientY) => {
                        if (!isDragging) return; isDragging = false;
                        const currentOffsetX = parseFloat(windowElement.dataset.offsetX);
                        const currentOffsetY = parseFloat(windowElement.dataset.offsetY);
                        windowElement.dataset.offsetX = currentOffsetX + (clientX - dragStartMouseX);
                        windowElement.dataset.offsetY = currentOffsetY + (clientY - dragStartMouseY);
                        header.style.cursor = 'grab';
                    };

                    header.addEventListener('mousedown', e => { onDragStart(e, e.clientX, e.clientY); document.addEventListener('mousemove', mouseMoveHandler); document.addEventListener('mouseup', mouseUpHandler); });
                    const mouseMoveHandler = e => onDragMove(e.clientX, e.clientY);
                    const mouseUpHandler = e => { onDragEnd(e.clientX, e.clientY); document.removeEventListener('mousemove', mouseMoveHandler); document.removeEventListener('mouseup', mouseUpHandler); };

                    header.addEventListener('touchstart', e => { onDragStart(e, e.touches[0].clientX, e.touches[0].clientY); document.addEventListener('touchmove', touchMoveHandler, { passive: false }); document.addEventListener('touchend', touchEndHandler); }, { passive: false });
                    const touchMoveHandler = e => { if(isDragging) { onDragMove(e.touches[0].clientX, e.touches[0].clientY); e.preventDefault(); }};
                    const touchEndHandler = e => { if(isDragging) { if (e.changedTouches.length > 0) onDragEnd(e.changedTouches[0].clientX, e.changedTouches[0].clientY); else onDragEnd(dragStartMouseX, dragStartMouseY); document.removeEventListener('touchmove', touchMoveHandler); document.removeEventListener('touchend', touchEndHandler); }};
                }

                windowElement.querySelector('.close-button')?.addEventListener('click', () => {
                    hideAnimatedElement(windowElement);
                    const taskbarIcon = taskbarLeft.querySelector(`.taskbar-app-icon[data-app="${appId}"]`);
                    if (taskbarIcon) taskbarIcon.remove();
                });
                
                windowElement.querySelector('.minimize-button')?.addEventListener('click', () => {
                    hideAnimatedElement(windowElement);
                    const taskbarIcon = taskbarLeft.querySelector(`.taskbar-app-icon[data-app="${appId}"]`);
                    if (taskbarIcon) taskbarIcon.classList.remove('active');
                });

                const maximizeButton = windowElement.querySelector('.maximize-button');
                if (maximizeButton) {
                    let isMaximized = false;
                    maximizeButton.addEventListener('click', () => {
                        const taskbarH = document.querySelector('.taskbar').offsetHeight;
                        if (!isMaximized) {
                            windowElement.dataset.originalState = JSON.stringify({ width: windowElement.style.width, height: windowElement.style.height, top: windowElement.style.top, left: windowElement.style.left, transform: windowElement.style.transform, offsetX: windowElement.dataset.offsetX, offsetY: windowElement.dataset.offsetY, borderRadius: windowElement.style.borderRadius, resize: windowElement.style.resize });
                            windowElement.style.width = '100%'; windowElement.style.height = `calc(100% - ${taskbarH}px)`;
                            windowElement.style.top = '0px'; windowElement.style.left = '0px';
                            windowElement.style.transform = 'none'; windowElement.style.borderRadius = '0';
                            windowElement.style.resize = 'none';
                            maximizeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z"/></svg>';
                            isMaximized = true;
                        } else {
                            const originalState = JSON.parse(windowElement.dataset.originalState);
                            windowElement.style.width = originalState.width || '80%'; windowElement.style.height = originalState.height || '80%';
                            windowElement.style.top = originalState.top || '50%'; windowElement.style.left = originalState.left || '50%';
                            windowElement.style.borderRadius = originalState.borderRadius || '8px';
                            windowElement.style.resize = originalState.resize || 'both';
                            windowElement.dataset.offsetX = originalState.offsetX || "0";
                            windowElement.dataset.offsetY = originalState.offsetY || "0";
                            windowElement.style.transform = `translate(-50%, -50%) translate3d(${originalState.offsetX}px, ${originalState.offsetY}px, 0) scale(1)`;

                            maximizeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/></svg>';
                            isMaximized = false;
                        }
                    });
                }
                windowElement.addEventListener('mousedown', () => bringWindowToFront(windowElement));
                windowElement.addEventListener('touchstart', () => bringWindowToFront(windowElement), { passive: true });
            });
        }

        let highestZIndex = 996;
        function bringWindowToFront(windowElement) {
             highestZIndex++;
             windowElement.style.zIndex = highestZIndex;
             const appId = windowElement.id.replace('-window', '');
             updateTaskbarActiveState(appId);
        }

        // --- Settings Apply Logic ---
        // applyDateButton and applyTimeButton listeners are removed
        applyUsernameButton.addEventListener('click', () => { currentUsername = settingsUsernameInput.value || 'ユーザー'; localStorage.setItem('username', currentUsername); applySettingsToDesktop(); });
        applyPcNameButton.addEventListener('click', () => { currentPcName = settingsPcNameInput.value || 'MY-PC'; localStorage.setItem('pcName', currentPcName); });
        applyPasswordButton.addEventListener('click', () => { storedPassword = settingsPasswordInput.value; localStorage.setItem('password', storedPassword); alert('パスワードが設定されました。'); });
        settingsLanguage.addEventListener('change', () => { currentLanguage = settingsLanguage.value; localStorage.setItem('language', currentLanguage); updateDateTime(); });
        settingsRegion.addEventListener('change', () => { currentRegion = settingsRegion.value; localStorage.setItem('region', currentRegion); updateDateTime(); });
        settingsKeyboard.addEventListener('change', () => { currentKeyboard = settingsKeyboard.value; localStorage.setItem('keyboard', currentKeyboard); });
        settingsMouseIcon.addEventListener('change', () => { currentMouseIcon = settingsMouseIcon.value; localStorage.setItem('mouseIcon', currentMouseIcon); updateCursorStyle(); });
        settingsWallpaper.addEventListener('change', () => { currentWallpaper = settingsWallpaper.value; localStorage.setItem('wallpaper', currentWallpaper); applySettingsToDesktop(); });


        // --- Calculator Logic ---
        function updateCalculatorDisplay() {
            if (calcCurrentInput === 'Error' || calcCurrentInput === '-Infinity' || calcCurrentInput === 'Infinity' || isNaN(parseFloat(calcCurrentInput))) {
                calculatorDisplay.textContent = calcCurrentInput;
            } else {
                const parts = calcCurrentInput.split('.');
                const integerPart = parts[0];
                const decimalPart = parts.length > 1 ? '.' + parts[1] : '';
                const formattedInteger = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                calculatorDisplay.textContent = formattedInteger + decimalPart;
            }
        }

        function resetCalculator() {
            calcCurrentInput = '0';
            calcPreviousInput = '';
            calcOperator = null;
            shouldResetDisplay = false;
            updateCalculatorDisplay();
        }

        function inputDigit(digit) {
            if (calcCurrentInput === '0' || shouldResetDisplay) {
                calcCurrentInput = digit;
                shouldResetDisplay = false;
            } else {
                calcCurrentInput += digit;
            }
            updateCalculatorDisplay();
        }

        function inputDecimal() {
            if (shouldResetDisplay) {
                calcCurrentInput = '0.';
                shouldResetDisplay = false;
                updateCalculatorDisplay();
                return;
            }
            if (!calcCurrentInput.includes('.')) {
                calcCurrentInput += '.';
            }
            updateCalculatorDisplay();
        }

        function handleOperator(nextOperator) {
            const inputValue = parseFloat(calcCurrentInput);

            if (calcOperator && calcPreviousInput !== '') {
                const prevValue = parseFloat(calcPreviousInput);
                const result = calculate(prevValue, inputValue, calcOperator);
                 if (result === 'Error') {
                    calcCurrentInput = 'Error';
                 } else {
                     calcCurrentInput = String(parseFloat(result.toFixed(10)));
                 }
                calcPreviousInput = calcCurrentInput;
            } else {
                 calcPreviousInput = calcCurrentInput;
            }

            calcOperator = nextOperator;
            shouldResetDisplay = true;
             updateCalculatorDisplay();
        }
        function calculate(firstOperand, secondOperand, operator) {
            if (operator === '+') return firstOperand + secondOperand;
            if (operator === '-') return firstOperand - secondOperand;
            if (operator === '*') return firstOperand * secondOperand;
            if (operator === '/') {
                if (secondOperand === 0) return 'Error';
                return firstOperand / secondOperand;
            }
            if (operator === '%') {
                 return firstOperand * (secondOperand / 100);
            }
            return secondOperand;
        }


        function handleEquals() {
             if (calcOperator === null || calcPreviousInput === '') {
                return;
            }
            const inputValue = parseFloat(calcCurrentInput);
            const prevValue = parseFloat(calcPreviousInput);
            const result = calculate(prevValue, inputValue, calcOperator);

            if (result === 'Error') {
                calcCurrentInput = 'Error';
            } else {
                 const formattedResult = parseFloat(result.toFixed(10));
                 calcCurrentInput = String(formattedResult);
            }
            calcOperator = null;
            calcPreviousInput = '';
            shouldResetDisplay = true;
            updateCalculatorDisplay();
        }
        function handleBackspace() {
             if (shouldResetDisplay) {
                 return;
             }
            if (calcCurrentInput === 'Error') {
                resetCalculator();
                return;
            }
            if (calcCurrentInput.length > 1) {
                calcCurrentInput = calcCurrentInput.slice(0, -1);
            } else {
                calcCurrentInput = '0';
            }
            updateCalculatorDisplay();
        }


        function initializeCalculator() {
            calculatorButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const { value } = button.dataset;

                    if (button.classList.contains('number')) {
                        if (value === '.') {
                            inputDecimal();
                        } else {
                            inputDigit(value);
                        }
                    } else if (button.classList.contains('operator')) {
                        if (value === 'clear') {
                            resetCalculator();
                        } else if (value === 'backspace') {
                            handleBackspace();
                        }
                        else if (value === '%') {
                            if (calcCurrentInput !== '0' && calcCurrentInput !== 'Error') {
                                calcCurrentInput = String(parseFloat(calcCurrentInput) / 100);
                                updateCalculatorDisplay();
                                shouldResetDisplay = true;
                            }
                        } else {
                            handleOperator(value);
                        }
                    } else if (button.classList.contains('equals')) {
                        handleEquals();
                    }
                });
            });
            resetCalculator();
        }
    </script>

</body>
</html>
